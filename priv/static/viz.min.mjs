var p=class{withFields(t){let n=Object.keys(this).map(r=>r in t?t[r]:this[r]);return new this.constructor(...n)}},Be=class{static fromArray(t,n){let r=n||new y;for(let i=t.length-1;i>=0;--i)r=new Fe(t[i],r);return r}[Symbol.iterator](){return new Gs(this)}toArray(){return[...this]}atLeastLength(t){let n=this;for(;t-- >0&&n;)n=n.tail;return n!==void 0}hasLength(t){let n=this;for(;t-- >0&&n;)n=n.tail;return t===-1&&n instanceof y}countLength(){let t=this,n=0;for(;t;)t=t.tail,n++;return n-1}};function h(e,t){return new Fe(e,t)}function a(e,t){return Be.fromArray(e,t)}var Gs=class{#e;constructor(t){this.#e=t}next(){if(this.#e instanceof y)return{done:!0};{let{head:t,tail:n}=this.#e;return this.#e=n,{value:t,done:!1}}}},y=class extends Be{},Fe=class extends Be{constructor(t,n){super(),this.head=t,this.tail=n}},Dn=class{bitSize;byteSize;bitOffset;rawBuffer;constructor(t,n,r){if(!(t instanceof Uint8Array))throw globalThis.Error("BitArray can only be constructed from a Uint8Array");if(this.bitSize=n??t.length*8,this.byteSize=Math.trunc((this.bitSize+7)/8),this.bitOffset=r??0,this.bitSize<0)throw globalThis.Error(`BitArray bit size is invalid: ${this.bitSize}`);if(this.bitOffset<0||this.bitOffset>7)throw globalThis.Error(`BitArray bit offset is invalid: ${this.bitOffset}`);if(t.length!==Math.trunc((this.bitOffset+this.bitSize+7)/8))throw globalThis.Error("BitArray buffer length is invalid");this.rawBuffer=t}byteAt(t){if(!(t<0||t>=this.byteSize))return hr(this.rawBuffer,this.bitOffset,t)}equals(t){if(this.bitSize!==t.bitSize)return!1;let n=Math.trunc(this.bitSize/8);if(this.bitOffset===0&&t.bitOffset===0){for(let i=0;i<n;i++)if(this.rawBuffer[i]!==t.rawBuffer[i])return!1;let r=this.bitSize%8;if(r){let i=8-r;if(this.rawBuffer[n]>>i!==t.rawBuffer[n]>>i)return!1}}else{for(let i=0;i<n;i++){let s=hr(this.rawBuffer,this.bitOffset,i),o=hr(t.rawBuffer,t.bitOffset,i);if(s!==o)return!1}let r=this.bitSize%8;if(r){let i=hr(this.rawBuffer,this.bitOffset,n),s=hr(t.rawBuffer,t.bitOffset,n),o=8-r;if(i>>o!==s>>o)return!1}}return!0}get buffer(){if(ca("buffer","Use BitArray.byteAt() or BitArray.rawBuffer instead"),this.bitOffset!==0||this.bitSize%8!==0)throw new globalThis.Error("BitArray.buffer does not support unaligned bit arrays");return this.rawBuffer}get length(){if(ca("length","Use BitArray.bitSize or BitArray.byteSize instead"),this.bitOffset!==0||this.bitSize%8!==0)throw new globalThis.Error("BitArray.length does not support unaligned bit arrays");return this.rawBuffer.length}};function hr(e,t,n){if(t===0)return e[n]??0;{let r=e[n]<<t&255,i=e[n+1]>>8-t;return r|i}}var Zr=class{constructor(t){this.value=t}},ua={};function ca(e,t){ua[e]||(console.warn(`Deprecated BitArray.${e} property used in JavaScript FFI code. ${t}.`),ua[e]=!0)}var Mn=class e extends p{static isResult(t){return t instanceof e}},$=class extends Mn{constructor(t){super(),this[0]=t}isOk(){return!0}},A=class extends Mn{constructor(t){super(),this[0]=t}isOk(){return!1}};function Z(e,t){let n=[e,t];for(;n.length;){let r=n.pop(),i=n.pop();if(r===i)continue;if(!fa(r)||!fa(i)||!mf(r,i)||cf(r,i)||ff(r,i)||df(r,i)||pf(r,i)||_f(r,i)||hf(r,i))return!1;let o=Object.getPrototypeOf(r);if(o!==null&&typeof o.equals=="function")try{if(r.equals(i))continue;return!1}catch{}let[l,u]=uf(r),c=l(r),f=l(i);if(c.length!==f.length)return!1;for(let d of c)n.push(u(r,d),u(i,d))}return!0}function uf(e){if(e instanceof Map)return[t=>t.keys(),(t,n)=>t.get(n)];{let t=e instanceof globalThis.Error?["message"]:[];return[n=>[...t,...Object.keys(n)],(n,r)=>n[r]]}}function cf(e,t){return e instanceof Date&&(e>t||e<t)}function ff(e,t){return!(e instanceof Dn)&&e.buffer instanceof ArrayBuffer&&e.BYTES_PER_ELEMENT&&!(e.byteLength===t.byteLength&&e.every((n,r)=>n===t[r]))}function df(e,t){return Array.isArray(e)&&e.length!==t.length}function pf(e,t){return e instanceof Map&&e.size!==t.size}function _f(e,t){return e instanceof Set&&(e.size!=t.size||[...e].some(n=>!t.has(n)))}function hf(e,t){return e instanceof RegExp&&(e.source!==t.source||e.flags!==t.flags)}function fa(e){return typeof e=="object"&&e!==null}function mf(e,t){return typeof e!="object"&&typeof t!="object"&&(!e||!t)||[Promise,WeakSet,WeakMap,Function].some(r=>e instanceof r)?!1:e.constructor===t.constructor}function mr(e,t,n,r,i,s,o){let l=new globalThis.Error(s);l.gleam_error=e,l.file=t,l.module=n,l.line=r,l.function=i,l.fn=i;for(let u in o)l[u]=o[u];return l}var Q=class extends p{constructor(t){super(),this[0]=t}},se=class extends p{};var da=new WeakMap,Ys=new DataView(new ArrayBuffer(8)),Xs=0;function Vs(e){let t=da.get(e);if(t!==void 0)return t;let n=Xs++;return Xs===2147483647&&(Xs=0),da.set(e,n),n}function Js(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}function Qs(e){let t=0,n=e.length;for(let r=0;r<n;r++)t=Math.imul(31,t)+e.charCodeAt(r)|0;return t}function _a(e){Ys.setFloat64(0,e);let t=Ys.getInt32(0),n=Ys.getInt32(4);return Math.imul(73244475,t>>16^t)^n}function $f(e){return Qs(e.toString())}function xf(e){let t=Object.getPrototypeOf(e);if(t!==null&&typeof t.hashCode=="function")try{let r=e.hashCode(e);if(typeof r=="number")return r}catch{}if(e instanceof Promise||e instanceof WeakSet||e instanceof WeakMap)return Vs(e);if(e instanceof Date)return _a(e.getTime());let n=0;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||e instanceof Uint8Array)for(let r=0;r<e.length;r++)n=Math.imul(31,n)+Ve(e[r])|0;else if(e instanceof Set)e.forEach(r=>{n=n+Ve(r)|0});else if(e instanceof Map)e.forEach((r,i)=>{n=n+Js(Ve(r),Ve(i))|0});else{let r=Object.keys(e);for(let i=0;i<r.length;i++){let s=r[i],o=e[s];n=n+Js(Ve(o),Qs(s))|0}}return n}function Ve(e){if(e===null)return 1108378658;if(e===void 0)return 1108378659;if(e===!0)return 1108378657;if(e===!1)return 1108378656;switch(typeof e){case"number":return _a(e);case"string":return Qs(e);case"bigint":return $f(e);case"object":return xf(e);case"symbol":return Vs(e);case"function":return Vs(e);default:return 0}}var $t=5,Zs=Math.pow(2,$t),wf=Zs-1,yf=Zs/2,gf=Zs/4,ze=0,mt=1,Re=2,un=3,eo={type:Re,bitmap:0,array:[]};function xr(e,t){return e>>>t&wf}function ti(e,t){return 1<<xr(e,t)}function bf(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function to(e,t){return bf(e&t-1)}function Je(e,t,n){let r=e.length,i=new Array(r);for(let s=0;s<r;++s)i[s]=e[s];return i[t]=n,i}function vf(e,t,n){let r=e.length,i=new Array(r+1),s=0,o=0;for(;s<t;)i[o++]=e[s++];for(i[o++]=n;s<r;)i[o++]=e[s++];return i}function Ks(e,t){let n=e.length,r=new Array(n-1),i=0,s=0;for(;i<t;)r[s++]=e[i++];for(++i;i<n;)r[s++]=e[i++];return r}function ha(e,t,n,r,i,s){let o=Ve(t);if(o===r)return{type:un,hash:o,array:[{type:ze,k:t,v:n},{type:ze,k:i,v:s}]};let l={val:!1};return wr(no(eo,e,o,t,n,l),e,r,i,s,l)}function wr(e,t,n,r,i,s){switch(e.type){case mt:return kf(e,t,n,r,i,s);case Re:return no(e,t,n,r,i,s);case un:return jf(e,t,n,r,i,s)}}function kf(e,t,n,r,i,s){let o=xr(n,t),l=e.array[o];if(l===void 0)return s.val=!0,{type:mt,size:e.size+1,array:Je(e.array,o,{type:ze,k:r,v:i})};if(l.type===ze)return Z(r,l.k)?i===l.v?e:{type:mt,size:e.size,array:Je(e.array,o,{type:ze,k:r,v:i})}:(s.val=!0,{type:mt,size:e.size,array:Je(e.array,o,ha(t+$t,l.k,l.v,n,r,i))});let u=wr(l,t+$t,n,r,i,s);return u===l?e:{type:mt,size:e.size,array:Je(e.array,o,u)}}function no(e,t,n,r,i,s){let o=ti(n,t),l=to(e.bitmap,o);if((e.bitmap&o)!==0){let u=e.array[l];if(u.type!==ze){let f=wr(u,t+$t,n,r,i,s);return f===u?e:{type:Re,bitmap:e.bitmap,array:Je(e.array,l,f)}}let c=u.k;return Z(r,c)?i===u.v?e:{type:Re,bitmap:e.bitmap,array:Je(e.array,l,{type:ze,k:r,v:i})}:(s.val=!0,{type:Re,bitmap:e.bitmap,array:Je(e.array,l,ha(t+$t,c,u.v,n,r,i))})}else{let u=e.array.length;if(u>=yf){let c=new Array(32),f=xr(n,t);c[f]=no(eo,t+$t,n,r,i,s);let d=0,_=e.bitmap;for(let m=0;m<32;m++){if((_&1)!==0){let w=e.array[d++];c[m]=w}_=_>>>1}return{type:mt,size:u+1,array:c}}else{let c=vf(e.array,l,{type:ze,k:r,v:i});return s.val=!0,{type:Re,bitmap:e.bitmap|o,array:c}}}}function jf(e,t,n,r,i,s){if(n===e.hash){let o=ro(e,r);if(o!==-1)return e.array[o].v===i?e:{type:un,hash:n,array:Je(e.array,o,{type:ze,k:r,v:i})};let l=e.array.length;return s.val=!0,{type:un,hash:n,array:Je(e.array,l,{type:ze,k:r,v:i})}}return wr({type:Re,bitmap:ti(e.hash,t),array:[e]},t,n,r,i,s)}function ro(e,t){let n=e.array.length;for(let r=0;r<n;r++)if(Z(t,e.array[r].k))return r;return-1}function ei(e,t,n,r){switch(e.type){case mt:return Ef(e,t,n,r);case Re:return Sf(e,t,n,r);case un:return Af(e,r)}}function Ef(e,t,n,r){let i=xr(n,t),s=e.array[i];if(s!==void 0){if(s.type!==ze)return ei(s,t+$t,n,r);if(Z(r,s.k))return s}}function Sf(e,t,n,r){let i=ti(n,t);if((e.bitmap&i)===0)return;let s=to(e.bitmap,i),o=e.array[s];if(o.type!==ze)return ei(o,t+$t,n,r);if(Z(r,o.k))return o}function Af(e,t){let n=ro(e,t);if(!(n<0))return e.array[n]}function io(e,t,n,r){switch(e.type){case mt:return Cf(e,t,n,r);case Re:return Tf(e,t,n,r);case un:return Bf(e,r)}}function Cf(e,t,n,r){let i=xr(n,t),s=e.array[i];if(s===void 0)return e;let o;if(s.type===ze){if(!Z(s.k,r))return e}else if(o=io(s,t+$t,n,r),o===s)return e;if(o===void 0){if(e.size<=gf){let l=e.array,u=new Array(e.size-1),c=0,f=0,d=0;for(;c<i;){let _=l[c];_!==void 0&&(u[f]=_,d|=1<<c,++f),++c}for(++c;c<l.length;){let _=l[c];_!==void 0&&(u[f]=_,d|=1<<c,++f),++c}return{type:Re,bitmap:d,array:u}}return{type:mt,size:e.size-1,array:Je(e.array,i,o)}}return{type:mt,size:e.size,array:Je(e.array,i,o)}}function Tf(e,t,n,r){let i=ti(n,t);if((e.bitmap&i)===0)return e;let s=to(e.bitmap,i),o=e.array[s];if(o.type!==ze){let l=io(o,t+$t,n,r);return l===o?e:l!==void 0?{type:Re,bitmap:e.bitmap,array:Je(e.array,s,l)}:e.bitmap===i?void 0:{type:Re,bitmap:e.bitmap^i,array:Ks(e.array,s)}}return Z(r,o.k)?e.bitmap===i?void 0:{type:Re,bitmap:e.bitmap^i,array:Ks(e.array,s)}:e}function Bf(e,t){let n=ro(e,t);if(n<0)return e;if(e.array.length!==1)return{type:un,hash:e.hash,array:Ks(e.array,n)}}function ma(e,t){if(e===void 0)return;let n=e.array,r=n.length;for(let i=0;i<r;i++){let s=n[i];if(s!==void 0){if(s.type===ze){t(s.v,s.k);continue}ma(s,t)}}}var jt=class e{static fromObject(t){let n=Object.keys(t),r=e.new();for(let i=0;i<n.length;i++){let s=n[i];r=r.set(s,t[s])}return r}static fromMap(t){let n=e.new();return t.forEach((r,i)=>{n=n.set(i,r)}),n}static new(){return new e(void 0,0)}constructor(t,n){this.root=t,this.size=n}get(t,n){if(this.root===void 0)return n;let r=ei(this.root,0,Ve(t),t);return r===void 0?n:r.v}set(t,n){let r={val:!1},i=this.root===void 0?eo:this.root,s=wr(i,0,Ve(t),t,n,r);return s===this.root?this:new e(s,r.val?this.size+1:this.size)}delete(t){if(this.root===void 0)return this;let n=io(this.root,0,Ve(t),t);return n===this.root?this:n===void 0?e.new():new e(n,this.size-1)}has(t){return this.root===void 0?!1:ei(this.root,0,Ve(t),t)!==void 0}entries(){if(this.root===void 0)return[];let t=[];return this.forEach((n,r)=>t.push([r,n])),t}forEach(t){ma(this.root,t)}hashCode(){let t=0;return this.forEach((n,r)=>{t=t+Js(Ve(n),Ve(r))|0}),t}equals(t){if(!(t instanceof e)||this.size!==t.size)return!1;try{return this.forEach((n,r)=>{if(!Z(t.get(r,!n),n))throw pa}),!0}catch(n){if(n===pa)return!1;throw n}}},pa=Symbol();var $e=class extends p{},xe=class extends p{},Et=class extends p{};var ve=class extends p{},cn=class extends p{};function Mf(e,t){for(;;){let n=e,r=t;if(n instanceof y)return r;e=n.tail,t=r+1}}function so(e){return Mf(e,0)}function Nn(e,t){for(;;){let n=e,r=t;if(n instanceof y)return r;{let i=n.head;e=n.tail,t=h(i,r)}}}function G(e){return Nn(e,a([]))}function St(e,t){for(;;){let n=e,r=t;if(n instanceof y)return!1;{let i=n.head;if(Z(i,r))return!0;e=n.tail,t=r}}}function Lf(e,t,n){for(;;){let r=e,i=t,s=n;if(r instanceof y)return G(s);{let o=r.head,l=r.tail,u;i(o)?u=h(o,s):u=s;let f=u;e=l,t=i,n=f}}}function we(e,t){return Lf(e,t,a([]))}function If(e,t,n){for(;;){let r=e,i=t,s=n;if(r instanceof y)return G(s);{let o=r.head,l=r.tail,u,c=i(o);if(c instanceof $){let d=c[0];u=h(d,s)}else u=s;let f=u;e=l,t=i,n=f}}}function fn(e,t){return If(e,t,a([]))}function Nf(e,t,n){for(;;){let r=e,i=t,s=n;if(r instanceof y)return G(s);{let o=r.head;e=r.tail,t=i,n=h(i(o),s)}}}function R(e,t){return Nf(e,t,a([]))}function Wf(e,t,n,r){for(;;){let i=e,s=t,o=n,l=r;if(i instanceof y)return[o,G(l)];{let u=i.head,c=i.tail,f=s(o,u),d,_;d=f[0],_=f[1],e=c,t=s,n=d,r=h(_,l)}}}function ga(e,t,n){return Wf(e,n,t,a([]))}function Pf(e,t,n,r){for(;;){let i=e,s=t,o=n,l=r;if(i instanceof y)return G(l);{let u=i.head,c=i.tail,f=h(s(u,o),l);e=c,t=s,n=o+1,r=f}}}function ba(e,t){return Pf(e,t,0,a([]))}function Ff(e,t){for(;;){let n=e,r=t;if(n instanceof y)return r;{let i=n.head;e=n.tail,t=h(i,r)}}}function Oe(e,t){return Ff(G(e),t)}function Rf(e,t){for(;;){let n=e,r=t;if(n instanceof y)return G(r);{let i=n.head;e=n.tail,t=Nn(i,r)}}}function Wn(e){return Rf(e,a([]))}function yr(e,t){return Wn(R(e,t))}function lt(e,t,n){for(;;){let r=e,i=t,s=n;if(r instanceof y)return i;{let o=r.head;e=r.tail,t=s(i,o),n=s}}}function ke(e,t){for(;;){let n=e,r=t;if(n instanceof y)return new A(void 0);{let i=n.head,s=n.tail;if(r(i))return new $(i);e=s,t=r}}}function ii(e,t){for(;;){let n=e,r=t;if(n instanceof y)return new A(void 0);{let i=n.head,s=n.tail,o=r(i);if(o instanceof $)return o;e=s,t=r}}}function Uf(e,t,n){for(;;){let r=e,i=t,s=n;if(r instanceof y)return G(s);{let o=r.head,l=r.tail;ja(i,o)?(e=l,t=i,n=s):(e=l,t=br(i,o,void 0),n=h(o,s))}}}function gr(e){return Uf(e,Fn(),a([]))}function Hf(e,t,n,r,i,s){for(;;){let o=e,l=t,u=n,c=r,f=i,d=s,_=h(f,u);if(o instanceof y)return c instanceof ve?h(G(_),d):h(_,d);{let m=o.head,w=o.tail,j=l(f,m);if(c instanceof ve)if(j instanceof $e)e=w,t=l,n=_,r=c,i=m,s=d;else if(j instanceof xe)e=w,t=l,n=_,r=c,i=m,s=d;else{let x;c instanceof ve?x=h(G(_),d):x=h(_,d);let S=x;if(w instanceof y)return h(a([m]),S);{let b=w.head,C=w.tail,D,g=l(m,b);g instanceof $e?D=new ve:g instanceof xe?D=new ve:D=new cn;let T=D;e=C,t=l,n=a([m]),r=T,i=b,s=S}}else if(j instanceof $e){let x;c instanceof ve?x=h(G(_),d):x=h(_,d);let S=x;if(w instanceof y)return h(a([m]),S);{let b=w.head,C=w.tail,D,g=l(m,b);g instanceof $e?D=new ve:g instanceof xe?D=new ve:D=new cn;let T=D;e=C,t=l,n=a([m]),r=T,i=b,s=S}}else if(j instanceof xe){let x;c instanceof ve?x=h(G(_),d):x=h(_,d);let S=x;if(w instanceof y)return h(a([m]),S);{let b=w.head,C=w.tail,D,g=l(m,b);g instanceof $e?D=new ve:g instanceof xe?D=new ve:D=new cn;let T=D;e=C,t=l,n=a([m]),r=T,i=b,s=S}}else e=w,t=l,n=_,r=c,i=m,s=d}}}function Gf(e,t,n,r){for(;;){let i=e,s=t,o=n,l=r;if(i instanceof y)return Nn(s,l);if(s instanceof y)return Nn(i,l);{let u=i.head,c=i.tail,f=s.head,d=s.tail,_=o(u,f);_ instanceof $e?(e=c,t=s,n=o,r=h(u,l)):_ instanceof xe?(e=i,t=d,n=o,r=h(f,l)):(e=i,t=d,n=o,r=h(f,l))}}}function Yf(e,t,n){for(;;){let r=e,i=t,s=n;if(r instanceof y)return G(s);{let o=r.tail;if(o instanceof y){let l=r.head;return G(h(G(l),s))}else{let l=r.head,u=o.head,c=o.tail,f=Gf(l,u,i,a([]));e=c,t=i,n=h(f,s)}}}}function Xf(e,t,n,r){for(;;){let i=e,s=t,o=n,l=r;if(i instanceof y)return Nn(s,l);if(s instanceof y)return Nn(i,l);{let u=i.head,c=i.tail,f=s.head,d=s.tail,_=o(u,f);_ instanceof $e?(e=i,t=d,n=o,r=h(f,l)):_ instanceof xe?(e=c,t=s,n=o,r=h(u,l)):(e=c,t=s,n=o,r=h(u,l))}}}function Vf(e,t,n){for(;;){let r=e,i=t,s=n;if(r instanceof y)return G(s);{let o=r.tail;if(o instanceof y){let l=r.head;return G(h(G(l),s))}else{let l=r.head,u=o.head,c=o.tail,f=Xf(l,u,i,a([]));e=c,t=i,n=h(f,s)}}}}function Jf(e,t,n){for(;;){let r=e,i=t,s=n;if(r instanceof y)return r;if(i instanceof ve){if(r.tail instanceof y)return r.head;e=Yf(r,s,a([])),t=new cn,n=s}else if(r.tail instanceof y){let l=r.head;return G(l)}else e=Vf(r,s,a([])),t=new ve,n=s}}function si(e,t){if(e instanceof y)return e;{let n=e.tail;if(n instanceof y)return e;{let r=e.head,i=n.head,s=n.tail,o,l=t(r,i);l instanceof $e?o=new ve:l instanceof xe?o=new ve:o=new cn;let u=o,c=Hf(s,t,a([r]),u,i,a([]));return Jf(c,new ve,t)}}}function va(e,t){return ii(e,n=>{let r,i;return r=n[0],i=n[1],Z(r,t)?new $(i):new A(void 0)})}function oo(e,t){return fn(e,n=>{let r,i;return r=n[0],i=n[1],Z(r,t)?new $(i):new A(void 0)})}function Pn(e,t){for(;;){let n=e,r=t;if(n instanceof y)return;{let i=n.head,s=n.tail;r(i),e=s,t=r}}}function Ea(e,t){return e===t?new xe:Ta(e,t)?new $e:new Et}function li(e,t){return e+t}function ed(e,t){for(;;){let n=e,r=t;if(n instanceof y)return r;{let i=n.head;e=n.tail,t=r+i}}}function co(e){return ed(e,"")}function td(e,t,n){for(;;){let r=e,i=t,s=n;if(r instanceof y)return s;{let o=r.head;e=r.tail,t=i,n=s+i+o}}}function ai(e,t){if(e instanceof y)return"";{let n=e.head,r=e.tail;return td(r,t,n)}}function ui(e,t){if(t==="")return lo(e);{let r=e,i=uo(r,t);return R(i,ae)}}function Sa(e){let t=Ca(e);if(t instanceof $){let n=t[0][0],r=t[0][1];return li(ao(n),At(r))}else return""}function Aa(e){let t=Ba(e);return t}var Ct=class extends p{constructor(t,n,r){super(),this.expected=t,this.found=n,this.path=r}},Qe=class extends p{constructor(t){super(),this.function=t}};function Ze(e,t){let n=t.function(e),r,i;return r=n[0],i=n[1],i instanceof y?new $(r):new A(i)}function ge(e){return new Qe(t=>[e,a([])])}function dn(e,t){return new Qe(n=>{let r=e.function(n),i,s;return i=r[0],s=r[1],[t(i),s]})}function cd(e,t,n){for(;;){let r=e,i=t,s=n;if(s instanceof y)return i;{let o=s.head,l=s.tail,u=o.function(r),c,f;if(c=u,f=u[1],f instanceof y)return c;e=r,t=i,n=l}}}function fo(e,t){return new Qe(n=>{let r=e.function(n),i,s;return i=r,s=r[1],s instanceof y?i:cd(n,i,t)})}function Oa(e,t){return a([new Ct(e,Ht(t),a([]))])}function po(e,t,n){let r=n(e);return r instanceof $?[r[0],a([])]:[r[0],a([new Ct(t,Ht(e),a([]))])]}function fd(e){return Z(!0,e)?[!0,a([])]:Z(!1,e)?[!1,a([])]:[!1,Oa("Bool",e)]}function dd(e){return po(e,"Int",La)}function pd(e){return po(e,"Float",Ma)}function kr(e,t){return new Qe(n=>[e,Oa(t,n)])}var pn=new Qe(fd),xt=new Qe(dd),di=new Qe(pd);function _d(e){return po(e,"String",Ia)}var ee=new Qe(_d);function Me(e){return new Qe(t=>Da(t,e.function,(n,r)=>fi(n,a([r])),0,a([])))}function fi(e,t){let n=fo(ee,a([dn(xt,re)])),r=R(t,s=>{let o=s,l=Ze(o,n);return l instanceof $?l[0]:"<"+Ht(o)+">"}),i=R(e[1],s=>new Ct(s.expected,s.found,Oe(r,s.path)));return[e[0],i]}function hd(e,t,n,r,i){for(;;){let s=e,o=t,l=n,u=r,c=i;if(s instanceof y){let f=l(u);return fi(f,G(o))}else{let f=s.head,d=s.tail,_=qa(u,f);if(_ instanceof $){let m=_[0];if(m instanceof Q){let w=m[0];e=d,t=h(f,o),n=l,r=w,i=c}else return c(u,h(f,o))}else{let m=_[0],w=l(u),j;j=w[0];let x=[j,a([new Ct(m,Ht(u),a([]))])];return fi(x,G(o))}}}}function Un(e,t,n){return new Qe(r=>{let i=hd(e,a([]),t.function,r,(f,d)=>{let _=t.function(f),m;m=_[0];let w=[m,a([new Ct("Field","Nothing",a([]))])];return fi(w,G(d))}),s,o;s=i[0],o=i[1];let l=n(s).function(r),u,c;return u=l[0],c=l[1],[u,Oe(o,c)]})}function L(e,t,n){return Un(a([e]),t,n)}var pi=void 0,Pa={};function ae(e){return e}function ri(e){return/^[-+]?(\d+)$/.test(e)?new $(parseInt(e)):new A(pi)}function In(e){return/^[-+]?(\d+)\.(\d+)([eE][-+]?\d+)?$/.test(e)?new $(parseFloat(e)):new A(pi)}function re(e){return e.toString()}function lo(e){let t=Ra(e);return t?Be.fromArray(Array.from(t).map(n=>n.segment)):Be.fromArray(e.match(/./gsu))}var Fa;function Ra(e){if(globalThis.Intl&&Intl.Segmenter)return Fa||=new Intl.Segmenter,Fa.segment(e)[Symbol.iterator]()}function Ca(e){let t,n=Ra(e);return n?t=n.next().value?.segment:t=e.match(/./su)?.[0],t?new $([t,e.slice(t.length)]):new A(pi)}function At(e){return e.toLowerCase()}function ao(e){return e.toUpperCase()}function Ta(e,t){return e<t}function uo(e,t){return Be.fromArray(e.split(t))}function ci(e,t){return e.startsWith(t)}var Ua=[" ","	",`
`,"\v","\f","\r","\x85","\u2028","\u2029"].join(""),D$=new RegExp(`^[${Ua}]*`),M$=new RegExp(`[${Ua}]*$`);function ho(e){console.log(e)}function Fn(){return jt.new()}function Rn(e,t){let n=e.get(t,Pa);return n===Pa?new A(pi):new $(n)}function Ha(e,t,n){return n.set(e,t)}function Ht(e){if(typeof e=="string")return"String";if(typeof e=="boolean")return"Bool";if(e instanceof Mn)return"Result";if(e instanceof Be)return"List";if(e instanceof Dn)return"BitArray";if(e instanceof jt)return"Dict";if(Number.isInteger(e))return"Int";if(Array.isArray(e))return"Array";if(typeof e=="number")return"Float";if(e===null)return"Nil";if(e===void 0)return"Nil";{let t=typeof e;return t.charAt(0).toUpperCase()+t.slice(1)}}function Ba(e){return new _o().inspect(e)}function Ue(e){let t=e.toString().replace("+","");if(t.indexOf(".")>=0)return t;{let n=t.indexOf("e");return n>=0?t.slice(0,n)+".0"+t.slice(n):t+".0"}}var _o=class{#e=new Set;inspect(t){let n=typeof t;if(t===!0)return"True";if(t===!1)return"False";if(t===null)return"//js(null)";if(t===void 0)return"Nil";if(n==="string")return this.#d(t);if(n==="bigint"||Number.isInteger(t))return t.toString();if(n==="number")return Ue(t);if(t instanceof Zr)return this.#s(t);if(t instanceof Dn)return this.#a(t);if(t instanceof RegExp)return`//js(${t})`;if(t instanceof Date)return`//js(Date("${t.toISOString()}"))`;if(t instanceof globalThis.Error)return`//js(${t.toString()})`;if(t instanceof Function){let i=[];for(let s of Array(t.length).keys())i.push(String.fromCharCode(s+97));return`//fn(${i.join(", ")}) { ... }`}if(this.#e.size===this.#e.add(t).size)return"//js(circular reference)";let r;if(Array.isArray(t))r=`#(${t.map(i=>this.inspect(i)).join(", ")})`;else if(t instanceof Be)r=this.#t(t);else if(t instanceof p)r=this.#i(t);else if(t instanceof jt)r=this.#r(t);else{if(t instanceof Set)return`//js(Set(${[...t].map(i=>this.inspect(i)).join(", ")}))`;r=this.#n(t)}return this.#e.delete(t),r}#n(t){let n=Object.getPrototypeOf(t)?.constructor?.name||"Object",r=[];for(let o of Object.keys(t))r.push(`${this.inspect(o)}: ${this.inspect(t[o])}`);let i=r.length?" "+r.join(", ")+" ":"";return`//js(${n==="Object"?"":n+" "}{${i}})`}#r(t){let n="dict.from_list([",r=!0;return t.forEach((i,s)=>{r||(n=n+", "),n=n+"#("+this.inspect(s)+", "+this.inspect(i)+")",r=!1}),n+"])"}#i(t){let n=Object.keys(t).map(r=>{let i=this.inspect(t[r]);return isNaN(parseInt(r))?`${r}: ${i}`:i}).join(", ");return n?`${t.constructor.name}(${n})`:t.constructor.name}#t(t){if(t instanceof y)return"[]";let n='charlist.from_string("',r="[",i=t;for(;i instanceof Fe;){let s=i.head;i=i.tail,r!=="["&&(r+=", "),r+=this.inspect(s),n&&(Number.isInteger(s)&&s>=32&&s<=126?n+=String.fromCharCode(s):n=null)}return n?n+'")':r+"]"}#d(t){let n='"';for(let r=0;r<t.length;r++){let i=t[r];switch(i){case`
`:n+="\\n";break;case"\r":n+="\\r";break;case"	":n+="\\t";break;case"\f":n+="\\f";break;case"\\":n+="\\\\";break;case'"':n+='\\"';break;default:i<" "||i>"~"&&i<"\xA0"?n+="\\u{"+i.charCodeAt(0).toString(16).toUpperCase().padStart(4,"0")+"}":n+=i}}return n+='"',n}#s(t){return`//utfcodepoint(${String.fromCodePoint(t.value)})`}#a(t){if(t.bitSize===0)return"<<>>";let n="<<";for(let r=0;r<t.byteSize-1;r++)n+=t.byteAt(r).toString(),n+=", ";if(t.byteSize*8===t.bitSize)n+=t.byteAt(t.byteSize-1).toString();else{let r=t.bitSize%8;n+=t.byteAt(t.byteSize-1)>>8-r,n+=`:size(${r})`}return n+=">>",n}};function qa(e,t){if(e instanceof jt||e instanceof WeakMap||e instanceof Map){let r={},i=e.get(t,r);return i===r?new $(new se):new $(new Q(i))}let n=Number.isInteger(t);if(n&&t>=0&&t<8&&e instanceof Be){let r=0;for(let i of e){if(r===t)return new $(new Q(i));r++}return new A("Indexable")}return n&&Array.isArray(e)||e&&typeof e=="object"||e&&Object.getPrototypeOf(e)===Object.prototype?t in e?new $(new Q(e[t])):new $(new se):new A(n?"Indexable":"Dict")}function Da(e,t,n,r,i){if(!(e instanceof Be||Array.isArray(e))){let o=new Ct("List",Ht(e),i);return[i,Be.fromArray([o])]}let s=[];for(let o of e){let l=t(o),[u,c]=l;if(c instanceof Fe){let[f,d]=n(l,r.toString());return[i,d]}s.push(u),r++}return[Be.fromArray(s),i]}function Ma(e){return typeof e=="number"?new $(e):new A(0)}function La(e){return Number.isInteger(e)?new $(e):new A(0)}function Ia(e){return typeof e=="string"?new $(e):new A("")}function md(e,t){return!Z(Rn(t,e),new A(void 0))}function ja(e,t){return md(t,e)}function br(e,t,n){return Ha(t,n,e)}function _i(e,t){if(e instanceof $){let n=e[0];return new $(t(n))}else return e}function jr(e,t){if(e instanceof $)return e;{let n=e[0];return new A(t(n))}}function at(e,t){if(e instanceof $){let n=e[0];return t(n)}else return e}function Gt(e,t){return e instanceof $?e[0]:t}function Ga(e){return fn(e,t=>t)}function mo(e,t,n){return e?t:n()}function je(e){return e}function $o(e){return JSON.stringify(e)}function Xa(e){return Object.fromEntries(e)}function Va(e){return e.toArray()}function Ja(e){try{let t=JSON.parse(e);return new $(t)}catch(t){return new A(wd(t,e))}}function wd(e,t){return yd(e)?new mi:gd(e,t)}function yd(e){return/((unexpected (end|eof))|(end of data)|(unterminated string)|(json( parse error|\.parse)\: expected '(\:|\}|\])'))/i.test(e.message)}function gd(e,t){let n=[bd,vd,jd,kd];for(let r of n){let i=r(e,t);if(i)return i}return new Yt("",0)}function bd(e){let n=/unexpected token '(.)', ".+" is not valid JSON/i.exec(e.message);if(!n)return null;let r=hi(n[1]);return new Yt(r,-1)}function vd(e){let n=/unexpected token (.) in JSON at position (\d+)/i.exec(e.message);if(!n)return null;let r=hi(n[1]),i=Number(n[2]);return new Yt(r,i)}function kd(e,t){let r=/(unexpected character|expected .*) at line (\d+) column (\d+)/i.exec(e.message);if(!r)return null;let i=Number(r[2]),s=Number(r[3]),o=Ed(i,s,t),l=hi(t[o]);return new Yt(l,o)}function jd(e){let n=/unexpected (identifier|token) "(.)"/i.exec(e.message);if(!n)return null;let r=hi(n[2]);return new Yt(r,0)}function hi(e){return"0x"+e.charCodeAt(0).toString(16).toUpperCase()}function Ed(e,t,n){if(e===1)return t-1;let r=1,i=0;return n.split("").find((s,o)=>(s===`
`&&(r+=1),r===e?(i=o+t,!0):!1)),i}var mi=class extends p{},Yt=class extends p{constructor(t){super(),this[0]=t}};var xo=class extends p{constructor(t){super(),this[0]=t}};function Sd(e,t){return at(Ja(e),n=>{let r=Ze(n,t);return jr(r,i=>new xo(i))})}function $i(e,t){return Sd(e,t)}function xi(e){return $o(e)}function _e(e){return e}function Er(e){return e}function wt(e){return e}function wi(e){return e}function et(e){return Xa(e)}function Ad(e){return Va(e)}function He(e,t){let r=R(e,t);return Ad(r)}var Le=()=>globalThis?.document,yi="http://www.w3.org/1999/xhtml",gi=1,yo=3;var Qa=!!globalThis.HTMLElement?.prototype?.moveBefore;var q=a([]),bi=new se;var Bd=new Et,zd=new $e,Od=new xe;function vi(e,t){return e.name===t.name?Od:e.name<t.name?zd:Bd}var ut=class extends p{constructor(t,n,r){super(),this.kind=t,this.name=n,this.value=r}},Gn=class extends p{constructor(t,n,r){super(),this.kind=t,this.name=n,this.value=r}},Ce=class extends p{constructor(t,n,r,i,s,o,l,u,c){super(),this.kind=t,this.name=n,this.handler=r,this.include=i,this.prevent_default=s,this.stop_propagation=o,this.immediate=l,this.debounce=u,this.throttle=c}},Yn=class extends p{constructor(t,n,r){super(),this.prevent_default=t,this.stop_propagation=n,this.message=r}},bo=class extends p{constructor(t){super(),this.kind=t}};var vo=class extends p{constructor(t){super(),this.kind=t}};function Nd(e,t){for(;;){let n=e,r=t;if(n instanceof y)return r;{let i=n.head;if(i instanceof ut){let s=i.name;if(s==="")e=n.tail,t=r;else if(s==="class"){let o=i.value;if(o==="")e=n.tail,t=r;else{let l=n.tail;if(l instanceof y){let u=i;e=l,t=h(u,r)}else{let u=l.head;if(u instanceof ut)if(u.name==="class"){let f=i.kind,d=o,_=l.tail,m=u.value,w=d+" "+m,j=new ut(f,"class",w);e=h(j,_),t=r}else{let f=i;e=l,t=h(f,r)}else{let c=i;e=l,t=h(c,r)}}}}else if(s==="style"){let o=i.value;if(o==="")e=n.tail,t=r;else{let l=n.tail;if(l instanceof y){let u=i;e=l,t=h(u,r)}else{let u=l.head;if(u instanceof ut)if(u.name==="style"){let f=i.kind,d=o,_=l.tail,m=u.value,w=d+";"+m,j=new ut(f,"style",w);e=h(j,_),t=r}else{let f=i;e=l,t=h(f,r)}else{let c=i;e=l,t=h(c,r)}}}}else{let o=i;e=n.tail,t=h(o,r)}}else{let s=i;e=n.tail,t=h(s,r)}}}}function ru(e){if(e instanceof y)return e;if(e.tail instanceof y)return e;{let r=si(e,(i,s)=>vi(s,i));return Nd(r,q)}}var ko=0;function iu(e,t){return new ut(ko,e,t)}var jo=1;function su(e,t){return new Gn(jo,e,t)}var Eo=2;function ou(e,t,n,r,i,s,o,l){return new Ce(Eo,e,t,n,r,i,s,o,l)}var So=0;var Ao=new bo(So);var ki=2,lu=new vo(ki);function W(e,t){return iu(e,t)}function au(e,t){return su(e,t)}function uu(e,t){return t?W(e,""):au(e,Er(!1))}function k(e){return W("class",e)}function qe(e){return W("id",e)}function ji(e){return W("accept",ai(e,","))}function Co(e){return uu("checked",e)}function gt(e){return W("for",e)}function cu(e){return W("form",e)}function Ie(e){return W("name",e)}function ct(e){return uu("selected",e)}function Ne(e){return W("type",e)}function fe(e){return W("value",e)}var Ei=class extends p{constructor(t,n,r){super(),this.synchronous=t,this.before_paint=n,this.after_paint=r}};var Bo=new Ei(a([]),a([]),a([]));function E(){return Bo}function mn(e){let t=n=>{let r=n.dispatch;return e(r)};return new Ei(a([t]),Bo.before_paint,Bo.after_paint)}function We(){return null}function Ar(e,t){let n=e?.get(t);return n!=null?new $(n):new A(void 0)}function Cr(e,t){return e&&e.has(t)}function $n(e,t,n){return e??=new Map,e.set(t,n),e}function zo(e,t){return e?.delete(t),e}var Ai=class extends p{},Ci=class extends p{constructor(t,n){super(),this.key=t,this.parent=n}},Oo=class extends p{constructor(t,n){super(),this.index=t,this.parent=n}};function Pd(e,t){for(;;){let n=e,r=t;if(r instanceof y)return!1;{let i=r.head,s=r.tail,o=ci(n,i);if(o)return o;e=n,t=s}}}function ft(e,t,n){return n===""?new Oo(t,e):new Ci(n,e)}var qo=new Ai,Tr="	";function fu(e,t){for(;;){let n=e,r=t;if(n instanceof Ai){if(r instanceof y)return"";{let i=r.tail;return co(i)}}else if(n instanceof Ci){let i=n.key;e=n.parent,t=h(Tr,h(i,r))}else{let i=n.index;e=n.parent,t=h(Tr,h(re(i),r))}}}function Fd(e){return fu(e,a([]))}function du(e,t){return t instanceof y?!1:Pd(Fd(e),t)}var Do=`
`;function Mo(e,t){return fu(e,a([Do,t]))}var tt=class extends p{constructor(t,n,r,i,s){super(),this.kind=t,this.key=n,this.mapper=r,this.children=i,this.keyed_children=s}},nt=class extends p{constructor(t,n,r,i,s,o,l,u,c,f){super(),this.kind=t,this.key=n,this.mapper=r,this.namespace=i,this.tag=s,this.attributes=o,this.children=l,this.keyed_children=u,this.self_closing=c,this.void=f}},rt=class extends p{constructor(t,n,r,i){super(),this.kind=t,this.key=n,this.mapper=r,this.content=i}},Vn=class extends p{constructor(t,n,r,i,s,o,l){super(),this.kind=t,this.key=n,this.mapper=r,this.namespace=i,this.tag=s,this.attributes=o,this.inner_html=l}};function Hd(e,t){return t===""?e==="area"||e==="base"||e==="br"||e==="col"||e==="embed"||e==="hr"||e==="img"||e==="input"||e==="link"||e==="meta"||e==="param"||e==="source"||e==="track"?!0:e==="wbr":!1}function _u(e,t){return t instanceof tt?new tt(t.kind,e,t.mapper,t.children,t.keyed_children):t instanceof nt?new nt(t.kind,e,t.mapper,t.namespace,t.tag,t.attributes,t.children,t.keyed_children,t.self_closing,t.void):t instanceof rt?new rt(t.kind,e,t.mapper,t.content):new Vn(t.kind,e,t.mapper,t.namespace,t.tag,t.attributes,t.inner_html)}var dt=0;function Lo(e,t,n,r){return new tt(dt,e,t,n,r)}var xn=1;function Jn(e,t,n,r,i,s,o,l,u){return new nt(xn,e,t,n,r,ru(i),s,o,l,u||Hd(r,n))}var Kn=2;function Io(e,t,n){return new rt(Kn,e,t,n)}var hu=3;var No=(e,t)=>e===t,wn=(e,t)=>{if(e===t)return!0;if(e==null||t==null)return!1;let n=typeof e;return n!==typeof t||n!=="object"||e.constructor!==t.constructor?!1:Array.isArray(e)?Gd(e,t):Yd(e,t)},Gd=(e,t)=>{let n=e.length;if(n!==t.length)return!1;for(;n--;)if(!wn(e[n],t[n]))return!1;return!0},Yd=(e,t)=>{let n=Object.keys(e),r=n.length;if(Object.keys(t).length!==r)return!1;for(;r--;){let i=n[r];if(!Object.hasOwn(t,i)||!wn(e[i],t[i]))return!1}return!0};var bt=class extends p{constructor(t,n,r){super(),this.handlers=t,this.dispatched_paths=n,this.next_dispatched_paths=r}};function wu(){return new bt(We(),q,q)}function yu(e){return new bt(e.handlers,e.next_dispatched_paths,q)}function gu(e,t,n){return zo(e,Mo(t,n))}function Br(e,t,n){let r=gu(e.handlers,t,n);return new bt(r,e.dispatched_paths,e.next_dispatched_paths)}function mu(e,t,n){return lt(n,e,(r,i)=>{if(i instanceof Ce){let s=i.name;return gu(r,t,s)}else return r})}function Bi(e,t,n,r){let i=h(t,e.next_dispatched_paths),s=new bt(e.handlers,e.dispatched_paths,i),o=Ar(s.handlers,t+Do+n);if(o instanceof $){let l=o[0];return[s,Ze(r,l)]}else return[s,new A(a([]))]}function zi(e,t){return du(t,e.dispatched_paths)}function bu(e,t,n,r,i){return $n(e,Mo(n,r),dn(i,s=>new Yn(s.prevent_default,s.stop_propagation,t(s.message))))}function zr(e,t,n,r,i){let s=bu(e.handlers,t,n,r,i);return new bt(s,e.dispatched_paths,e.next_dispatched_paths)}function $u(e,t,n,r){return lt(r,e,(i,s)=>{if(s instanceof Ce){let o=s.name,l=s.handler;return bu(i,t,n,o,l)}else return i})}function Xt(e,t){let n=No(e,je);return No(t,je)?e:n?t:i=>e(t(i))}function xu(e,t,n,r){for(;;){let i=e,s=t,o=n,l=r;if(l instanceof y)return i;{let u=l.head,c=l.tail;e=vu(i,s,o,u),t=s,n=o+1,r=c}}}function vu(e,t,n,r){if(r instanceof tt){let i=r.children,s=ft(t,n,r.key);return xu(e,s,0,i)}else if(r instanceof nt){let i=r.attributes,s=r.children,o=ft(t,n,r.key),u=mu(e,o,i);return xu(u,o,0,s)}else{if(r instanceof rt)return e;{let i=r.attributes,s=ft(t,n,r.key);return mu(e,s,i)}}}function Bt(e,t,n,r){let i=vu(e.handlers,t,n,r);return new bt(i,e.dispatched_paths,e.next_dispatched_paths)}function Wo(e,t,n,r,i){for(;;){let s=e,o=t,l=n,u=r,c=i;if(c instanceof y)return s;{let f=c.head,d=c.tail;e=ku(s,o,l,u,f),t=o,n=l,r=u+1,i=d}}}function ku(e,t,n,r,i){if(i instanceof tt){let s=i.children,o=ft(n,r,i.key),l=Xt(t,i.mapper);return Wo(e,l,o,0,s)}else if(i instanceof nt){let s=i.attributes,o=i.children,l=ft(n,r,i.key),u=Xt(t,i.mapper),f=$u(e,u,l,s);return Wo(f,u,l,0,o)}else{if(i instanceof rt)return e;{let s=i.attributes,o=ft(n,r,i.key),l=Xt(t,i.mapper);return $u(e,l,o,s)}}}function Vt(e,t,n,r,i){let s=ku(e.handlers,t,n,r,i);return new bt(s,e.dispatched_paths,e.next_dispatched_paths)}function ju(e,t,n,r,i){let s=Wo(e.handlers,t,n,r,i);return new bt(s,e.dispatched_paths,e.next_dispatched_paths)}function Ee(e,t,n){return Jn("",je,"",e,t,n,We(),!1,!1)}function Oi(e,t,n,r){return Jn("",je,e,t,n,r,We(),!1,!1)}function F(e){return Io("",je,e)}function zt(){return Io("",je,"")}function Jt(e){return F(e)}function Eu(e,t){return Ee("h1",e,t)}function Su(e,t){return Ee("nav",e,t)}function O(e,t){return Ee("div",e,t)}function Kt(e,t){return Ee("p",e,t)}function Di(e,t){return Ee("a",e,t)}function Au(e,t){return Ee("span",e,t)}function Te(e,t){return Ee("button",e,t)}function Qt(e,t){return Ee("form",e,t)}function pt(e){return Ee("input",e,q)}function Pe(e,t){return Ee("label",e,t)}function Ge(e,t){return Ee("option",e,a([F(t)]))}function yn(e,t){return Ee("select",e,t)}var Qn=class extends p{constructor(t,n,r,i){super(),this.index=t,this.removed=n,this.changes=r,this.children=i}},Po=class extends p{constructor(t,n){super(),this.kind=t,this.content=n}},Fo=class extends p{constructor(t,n){super(),this.kind=t,this.inner_html=n}},Ro=class extends p{constructor(t,n,r){super(),this.kind=t,this.added=n,this.removed=r}},Uo=class extends p{constructor(t,n,r){super(),this.kind=t,this.key=n,this.before=r}},Ho=class extends p{constructor(t,n,r){super(),this.kind=t,this.index=n,this.with=r}},Go=class extends p{constructor(t,n){super(),this.kind=t,this.index=n}},Yo=class extends p{constructor(t,n,r){super(),this.kind=t,this.children=n,this.before=r}};function Xo(e,t,n,r){return new Qn(e,t,n,r)}var Vo=0;function Cu(e){return new Po(Vo,e)}var Jo=1;function Tu(e){return new Fo(Jo,e)}var Ko=2;function Qo(e,t){return new Ro(Ko,e,t)}var Zo=3;function Bu(e,t){return new Uo(Zo,e,t)}var el=4;function zu(e){return new Go(el,e)}var tl=5;function gn(e,t){return new Ho(tl,e,t)}var nl=6;function rl(e,t){return new Yo(nl,e,t)}var Li=class extends p{constructor(t,n){super(),this.patch=t,this.events=n}},il=class extends p{constructor(t,n,r){super(),this.added=t,this.removed=n,this.events=r}};function Vd(e,t,n,r){return n==="input"&&t===""?zi(e,r):n==="select"&&t===""?zi(e,r):n==="textarea"&&t===""?zi(e,r):!1}function Du(e,t,n,r,i,s,o,l){for(;;){let u=e,c=t,f=n,d=r,_=i,m=s,w=o,j=l;if(m instanceof y){if(_ instanceof y)return new il(w,j,d);{let x=_.head;if(x instanceof Ce){let S=x,b=_.tail,C=x.name,D=h(S,j),g=Br(d,c,C);e=u,t=c,n=f,r=g,i=b,s=m,o=w,l=D}else{let S=x,b=_.tail,C=h(S,j);e=u,t=c,n=f,r=d,i=b,s=m,o=w,l=C}}}else if(_ instanceof y){let x=m.head;if(x instanceof Ce){let S=x,b=m.tail,C=x.name,D=x.handler,g=h(S,w),T=zr(d,f,c,C,D);e=u,t=c,n=f,r=T,i=_,s=b,o=g,l=j}else{let S=x,b=m.tail,C=h(S,w);e=u,t=c,n=f,r=d,i=_,s=b,o=C,l=j}}else{let x=m.head,S=m.tail,b=_.head,C=_.tail,D=vi(b,x);if(D instanceof $e)if(b instanceof Ce){let g=b.name,T=h(b,j),B=Br(d,c,g);e=u,t=c,n=f,r=B,i=C,s=m,o=w,l=T}else{let g=h(b,j);e=u,t=c,n=f,r=d,i=C,s=m,o=w,l=g}else if(D instanceof xe)if(x instanceof ut)if(b instanceof ut){let g,T=x.name;T==="value"||T==="checked"||T==="selected"?g=u||b.value!==x.value:g=b.value!==x.value;let B=g,I;B?I=h(x,w):I=w;let U=I;e=u,t=c,n=f,r=d,i=C,s=S,o=U,l=j}else if(b instanceof Ce){let g=b.name,T=h(x,w),B=h(b,j),I=Br(d,c,g);e=u,t=c,n=f,r=I,i=C,s=S,o=T,l=B}else{let g=h(x,w),T=h(b,j);e=u,t=c,n=f,r=d,i=C,s=S,o=g,l=T}else if(x instanceof Gn)if(b instanceof Gn){let g,T=x.name;T==="scrollLeft"||T==="scrollRight"?g=!0:T==="value"?g=u||!wn(b.value,x.value):T==="checked"?g=u||!wn(b.value,x.value):T==="selected"?g=u||!wn(b.value,x.value):g=!wn(b.value,x.value);let B=g,I;B?I=h(x,w):I=w;let U=I;e=u,t=c,n=f,r=d,i=C,s=S,o=U,l=j}else if(b instanceof Ce){let g=b.name,T=h(x,w),B=h(b,j),I=Br(d,c,g);e=u,t=c,n=f,r=I,i=C,s=S,o=T,l=B}else{let g=h(x,w),T=h(b,j);e=u,t=c,n=f,r=d,i=C,s=S,o=g,l=T}else if(b instanceof Ce){let g=x.name,T=x.handler,B=b.prevent_default.kind!==x.prevent_default.kind||b.stop_propagation.kind!==x.stop_propagation.kind||b.immediate!==x.immediate||b.debounce!==x.debounce||b.throttle!==x.throttle,I;B?I=h(x,w):I=w;let U=I,V=zr(d,f,c,g,T);e=u,t=c,n=f,r=V,i=C,s=S,o=U,l=j}else{let g=x.name,T=x.handler,B=h(x,w),I=h(b,j),U=zr(d,f,c,g,T);e=u,t=c,n=f,r=U,i=C,s=S,o=B,l=I}else if(x instanceof Ce){let g=x.name,T=x.handler,B=h(x,w),I=zr(d,f,c,g,T);e=u,t=c,n=f,r=I,i=_,s=S,o=B,l=j}else{let g=h(x,w);e=u,t=c,n=f,r=d,i=_,s=S,o=g,l=j}}}}function sl(e,t,n,r,i,s,o,l,u,c,f,d,_,m){for(;;){let w=e,j=t,x=n,S=r,b=i,C=s,D=o,g=l,T=u,B=c,I=f,U=d,V=_,oe=m;if(x instanceof y){if(w instanceof y)return new Li(new Qn(T,D,I,U),oe);{let Ae=w.head,st=w.tail,ue;Ae.key===""||!Cr(b,Ae.key)?ue=D+1:ue=D;let N=ue,z=Bt(oe,B,g,Ae);e=st,t=j,n=x,r=S,i=b,s=C,o=N,l=g,u=T,c=B,f=I,d=U,_=V,m=z}}else if(w instanceof y){let Ae=ju(oe,V,B,g,x),st=rl(x,g-C),ue=h(st,I);return new Li(new Qn(T,D,ue,U),Ae)}else{let Ae=x.head,st=w.head;if(st.key!==Ae.key){let ue=x.tail,le=w.tail,N=Ar(j,Ae.key),z=Cr(S,st.key);if(N instanceof $)if(z){let Y=N[0];if(Cr(b,st.key))e=le,t=j,n=x,r=S,i=b,s=C-1,o=D,l=g,u=T,c=B,f=I,d=U,_=V,m=oe;else{let ie=g-C,J=h(Bu(Ae.key,ie),I),pe=$n(b,Ae.key,void 0),ne=C+1;e=h(Y,w),t=j,n=x,r=S,i=pe,s=ne,o=D,l=g,u=T,c=B,f=J,d=U,_=V,m=oe}}else{let Y=g-C,te=h(zu(Y),I),ie=Bt(oe,B,g,st),J=C-1;e=le,t=j,n=x,r=S,i=b,s=J,o=D,l=g,u=T,c=B,f=te,d=U,_=V,m=ie}else if(z){let Y=g-C,te=Vt(oe,V,B,g,Ae),ie=rl(a([Ae]),Y),J=h(ie,I);e=w,t=j,n=ue,r=S,i=b,s=C+1,o=D,l=g+1,u=T,c=B,f=J,d=U,_=V,m=te}else{let Y=gn(g-C,Ae),te,J=Bt(oe,B,g,st);te=Vt(J,V,B,g,Ae);let pe=te;e=le,t=j,n=ue,r=S,i=b,s=C,o=D,l=g+1,u=T,c=B,f=h(Y,I),d=U,_=V,m=pe}}else{let ue=w.head;if(ue instanceof tt){let le=x.head;if(le instanceof tt){let N=le,z=x.tail,Y=ue,te=w.tail,ie=Xt(V,N.mapper),J=ft(B,g,N.key),pe=sl(Y.children,Y.keyed_children,N.children,N.keyed_children,We(),0,0,0,g,J,q,q,ie,oe),ne,me=pe.patch;me.children instanceof y?me.changes instanceof y?me.removed===0?ne=U:ne=h(pe.patch,U):ne=h(pe.patch,U):ne=h(pe.patch,U);let ht=ne;e=te,t=j,n=z,r=S,i=b,s=C,o=D,l=g+1,u=T,c=B,f=I,d=ht,_=V,m=pe.events}else{let N=le,z=x.tail,Y=ue,te=w.tail,ie=gn(g-C,N),J,ne=Bt(oe,B,g,Y);J=Vt(ne,V,B,g,N);let me=J;e=te,t=j,n=z,r=S,i=b,s=C,o=D,l=g+1,u=T,c=B,f=h(ie,I),d=U,_=V,m=me}}else if(ue instanceof nt){let le=x.head;if(le instanceof nt){let N=le,z=ue;if(z.namespace===N.namespace&&z.tag===N.tag){let Y=x.tail,te=w.tail,ie=Xt(V,N.mapper),J=ft(B,g,N.key),pe=Vd(oe,N.namespace,N.tag,J),ne=Du(pe,J,ie,oe,z.attributes,N.attributes,q,q),me,kt,ht;me=ne.added,kt=ne.removed,ht=ne.events;let ln;kt instanceof y&&me instanceof y?ln=q:ln=a([Qo(me,kt)]);let On=ln,qn=sl(z.children,z.keyed_children,N.children,N.keyed_children,We(),0,0,0,g,J,On,q,ie,ht),Rt,an=qn.patch;an.children instanceof y?an.changes instanceof y?an.removed===0?Rt=U:Rt=h(qn.patch,U):Rt=h(qn.patch,U):Rt=h(qn.patch,U);let af=Rt;e=te,t=j,n=Y,r=S,i=b,s=C,o=D,l=g+1,u=T,c=B,f=I,d=af,_=V,m=qn.events}else{let Y=le,te=x.tail,ie=ue,J=w.tail,pe=gn(g-C,Y),ne,kt=Bt(oe,B,g,ie);ne=Vt(kt,V,B,g,Y);let ht=ne;e=J,t=j,n=te,r=S,i=b,s=C,o=D,l=g+1,u=T,c=B,f=h(pe,I),d=U,_=V,m=ht}}else{let N=le,z=x.tail,Y=ue,te=w.tail,ie=gn(g-C,N),J,ne=Bt(oe,B,g,Y);J=Vt(ne,V,B,g,N);let me=J;e=te,t=j,n=z,r=S,i=b,s=C,o=D,l=g+1,u=T,c=B,f=h(ie,I),d=U,_=V,m=me}}else if(ue instanceof rt){let le=x.head;if(le instanceof rt){let N=le;if(ue.content===N.content){let Y=x.tail;e=w.tail,t=j,n=Y,r=S,i=b,s=C,o=D,l=g+1,u=T,c=B,f=I,d=U,_=V,m=oe}else{let Y=le,te=x.tail,ie=w.tail,J=Xo(g,0,a([Cu(Y.content)]),q);e=ie,t=j,n=te,r=S,i=b,s=C,o=D,l=g+1,u=T,c=B,f=I,d=h(J,U),_=V,m=oe}}else{let N=le,z=x.tail,Y=ue,te=w.tail,ie=gn(g-C,N),J,ne=Bt(oe,B,g,Y);J=Vt(ne,V,B,g,N);let me=J;e=te,t=j,n=z,r=S,i=b,s=C,o=D,l=g+1,u=T,c=B,f=h(ie,I),d=U,_=V,m=me}}else{let le=x.head;if(le instanceof Vn){let N=le,z=x.tail,Y=ue,te=w.tail,ie=Xt(V,N.mapper),J=ft(B,g,N.key),pe=Du(!1,J,ie,oe,Y.attributes,N.attributes,q,q),ne,me,kt;ne=pe.added,me=pe.removed,kt=pe.events;let ht;me instanceof y&&ne instanceof y?ht=q:ht=a([Qo(ne,me)]);let ln=ht,On;Y.inner_html===N.inner_html?On=ln:On=h(Tu(N.inner_html),ln);let Rt=On,an;Rt instanceof y?an=U:an=h(Xo(g,0,Rt,a([])),U);let aa=an;e=te,t=j,n=z,r=S,i=b,s=C,o=D,l=g+1,u=T,c=B,f=I,d=aa,_=V,m=kt}else{let N=le,z=x.tail,Y=ue,te=w.tail,ie=gn(g-C,N),J,ne=Bt(oe,B,g,Y);J=Vt(ne,V,B,g,N);let me=J;e=te,t=j,n=z,r=S,i=b,s=C,o=D,l=g+1,u=T,c=B,f=h(ie,I),d=U,_=V,m=me}}}}}}function ol(e,t,n){return sl(a([t]),We(),a([n]),We(),We(),0,0,0,0,qo,q,q,je,yu(e))}var Kd=globalThis.setTimeout,ll=globalThis.clearTimeout,Qd=(e,t)=>Le().createElementNS(e,t),Zd=e=>Le().createTextNode(e),ep=()=>Le().createDocumentFragment(),Zn=(e,t,n)=>e.insertBefore(t,n),Mu=Qa?(e,t,n)=>e.moveBefore(t,n):Zn,tp=(e,t)=>e.removeChild(t),np=(e,t)=>e.getAttribute(t),Lu=(e,t,n)=>e.setAttribute(t,n),rp=(e,t)=>e.removeAttribute(t),ip=(e,t,n,r)=>e.addEventListener(t,n,r),Iu=(e,t,n)=>e.removeEventListener(t,n),sp=(e,t)=>e.innerHTML=t,op=(e,t)=>e.data=t,Ot=Symbol("lustre"),ul=class{constructor(t,n,r,i){this.kind=t,this.key=i,this.parent=n,this.children=[],this.node=r,this.handlers=new Map,this.throttles=new Map,this.debouncers=new Map}get parentNode(){return this.kind===dt?this.node.parentNode:this.node}};var qt=(e,t,n,r,i)=>{let s=new ul(e,t,n,i);return n[Ot]=s,t?.children.splice(r,0,s),s},lp=e=>{let t="";for(let n=e[Ot];n.parent;n=n.parent)if(n.key)t=`${Tr}${n.key}${t}`;else{let r=n.parent.children.indexOf(n);t=`${Tr}${r}${t}`}return t.slice(1)},Ii=class{#e=null;#n=()=>{};#r=!1;#i=!1;constructor(t,n,{useServerEvents:r=!1,exposeKeys:i=!1}={}){this.#e=t,this.#n=n,this.#r=r,this.#i=i}mount(t){qt(xn,null,this.#e,0,null),this.#x(this.#e,null,this.#e[Ot],0,t)}push(t){this.#t.push({node:this.#e[Ot],patch:t}),this.#d()}#t=[];#d(){let t=this.#t;for(;t.length;){let{node:n,patch:r}=t.pop(),{children:i}=n,{changes:s,removed:o,children:l}=r;bn(s,u=>this.#s(n,u)),o&&this.#_(n,i.length-o,o),bn(l,u=>{let c=i[u.index|0];this.#t.push({node:c,patch:u})})}}#s(t,n){switch(n.kind){case Vo:this.#v(t,n);break;case Jo:this.#w(t,n);break;case Ko:this.#h(t,n);break;case Zo:this.#u(t,n);break;case el:this.#l(t,n);break;case tl:this.#p(t,n);break;case nl:this.#a(t,n);break}}#a(t,{children:n,before:r}){let i=ep(),s=this.#o(t,r);this.#$(i,null,t,r|0,n),Zn(t.parentNode,i,s)}#p(t,{index:n,with:r}){this.#_(t,n|0,1);let i=this.#o(t,n);this.#x(t.parentNode,i,t,n|0,r)}#o(t,n){n=n|0;let{children:r}=t,i=r.length;if(n<i)return r[n].node;let s=r[i-1];if(!s&&t.kind!==dt)return null;for(s||(s=t);s.kind===dt&&s.children.length;)s=s.children[s.children.length-1];return s.node.nextSibling}#u(t,{key:n,before:r}){r=r|0;let{children:i,parentNode:s}=t,o=i[r].node,l=i[r];for(let d=r+1;d<i.length;++d){let _=i[d];if(i[d]=l,l=_,_.key===n){i[r]=_;break}}let{kind:u,node:c,children:f}=l;Mu(s,c,o),u===dt&&this.#c(s,f,o)}#c(t,n,r){for(let i=0;i<n.length;++i){let{kind:s,node:o,children:l}=n[i];Mu(t,o,r),s===dt&&this.#c(t,l,r)}}#l(t,{index:n}){this.#_(t,n,1)}#_(t,n,r){let{children:i,parentNode:s}=t,o=i.splice(n,r);for(let l=0;l<o.length;++l){let{kind:u,node:c,children:f}=o[l];tp(s,c),this.#f(o[l]),u===dt&&o.push(...f)}}#f(t){let{debouncers:n,children:r}=t;for(let{timeout:i}of n.values())i&&ll(i);n.clear(),bn(r,i=>this.#f(i))}#h({node:t,handlers:n,throttles:r,debouncers:i},{added:s,removed:o}){bn(o,({name:l})=>{n.delete(l)?(Iu(t,l,al),this.#m(r,l,0),this.#m(i,l,0)):(rp(t,l),Wu[l]?.removed?.(t,l))}),bn(s,l=>this.#b(t,l))}#v({node:t},{content:n}){op(t,n??"")}#w({node:t},{inner_html:n}){sp(t,n??"")}#$(t,n,r,i,s){bn(s,o=>this.#x(t,n,r,i++,o))}#x(t,n,r,i,s){switch(s.kind){case xn:{let o=this.#y(r,i,s);this.#$(o,null,o[Ot],0,s.children),Zn(t,o,n);break}case Kn:{let o=this.#g(r,i,s);Zn(t,o,n);break}case dt:{let o=this.#g(r,i,s);Zn(t,o,n),this.#$(t,n,o[Ot],0,s.children);break}case hu:{let o=this.#y(r,i,s);this.#w({node:o},s),Zn(t,o,n);break}}}#y(t,n,{kind:r,key:i,tag:s,namespace:o,attributes:l}){let u=Qd(o||yi,s);return qt(r,t,u,n,i),this.#i&&i&&Lu(u,"data-lustre-key",i),bn(l,c=>this.#b(u,c)),u}#g(t,n,{kind:r,key:i,content:s}){let o=Zd(s??"");return qt(r,t,o,n,i),o}#b(t,n){let{debouncers:r,handlers:i,throttles:s}=t[Ot],{kind:o,name:l,value:u,prevent_default:c,debounce:f,throttle:d}=n;switch(o){case ko:{let _=u??"";if(l==="virtual:defaultValue"){t.defaultValue=_;return}_!==np(t,l)&&Lu(t,l,_),Wu[l]?.added?.(t,_);break}case jo:t[l]=u;break;case Eo:{i.has(l)&&Iu(t,l,al);let _=c.kind===So;ip(t,l,al,{passive:_}),this.#m(s,l,d),this.#m(r,l,f),i.set(l,m=>this.#k(n,m));break}}}#m(t,n,r){let i=t.get(n);if(r>0)i?i.delay=r:t.set(n,{delay:r});else if(i){let{timeout:s}=i;s&&ll(s),t.delete(n)}}#k(t,n){let{currentTarget:r,type:i}=n,{debouncers:s,throttles:o}=r[Ot],l=lp(r),{prevent_default:u,stop_propagation:c,include:f,immediate:d}=t;u.kind===ki&&n.preventDefault(),c.kind===ki&&n.stopPropagation(),i==="submit"&&(n.detail??={},n.detail.formData=[...new FormData(n.target,n.submitter).entries()]);let _=this.#r?ap(n,f??[]):n,m=o.get(i);if(m){let j=Date.now(),x=m.last||0;j>x+m.delay&&(m.last=j,m.lastEvent=n,this.#n(_,l,i,d))}let w=s.get(i);w&&(ll(w.timeout),w.timeout=Kd(()=>{n!==o.get(i)?.lastEvent&&this.#n(_,l,i,d)},w.delay)),!m&&!w&&this.#n(_,l,i,d)}},bn=(e,t)=>{if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else if(e)for(e;e.head;e=e.tail)t(e.head)},al=e=>{let{currentTarget:t,type:n}=e;t[Ot].handlers.get(n)(e)},ap=(e,t=[])=>{let n={};(e.type==="input"||e.type==="change")&&t.push("target.value"),e.type==="submit"&&t.push("detail.formData");for(let r of t){let i=r.split(".");for(let s=0,o=e,l=n;s<i.length;s++){if(s===i.length-1){l[i[s]]=o[i[s]];break}l=l[i[s]]??={},o=o[i[s]]}}return n},Nu=e=>({added(t){t[e]=!0},removed(t){t[e]=!1}}),up=e=>({added(t,n){t[e]=n}}),Wu={checked:Nu("checked"),selected:Nu("selected"),value:up("value"),autofocus:{added(e){queueMicrotask(()=>{e.focus?.()})}},autoplay:{added(e){try{e.play?.()}catch(t){console.error(t)}}}};function cp(e,t,n){for(;;){let r=e,i=t,s=n;if(r instanceof y)return[i,G(s)];{let o=r.tail,l=r.head[0],u=r.head[1],c=_u(l,u),f;l===""?f=i:f=$n(i,l,c);let d=f,_=h(c,s);e=o,t=d,n=_}}}function cl(e){return cp(e,We(),q)}function Pu(e,t,n){let r=cl(n),i,s;return i=r[0],s=r[1],Jn("",je,"",e,t,s,i,!1,!1)}function Fu(e,t,n,r){let i=cl(r),s,o;return s=i[0],o=i[1],Jn("",je,e,t,n,o,s,!1,!1)}function Ru(e){let t=cl(e),n,r;return n=t[0],r=t[1],Lo("",je,r,n)}var Uu=e=>{let t=qt(xn,null,e,0,null),n=0;for(let o=e.firstChild;o;o=o.nextSibling)Hu(o)&&(n+=1);if(n===0){let o=Le().createTextNode("");return qt(Kn,t,o,0,null),e.replaceChildren(o),zt()}if(n===1)return fl(t,e).head[1];let r=Le().createTextNode(""),i=qt(dt,t,r,0,null),s=fl(i,e);return e.insertBefore(r,e.firstChild),Ru(s)},Hu=e=>{switch(e.nodeType){case gi:return!0;case yo:return!!e.data;default:return!1}},fp=(e,t,n,r)=>{if(!Hu(t))return null;switch(t.nodeType){case gi:{let i=qt(xn,e,t,r,n),s=t.localName,o=t.namespaceURI,l=!o||o===yi;l&&dp.includes(s)&&pp(s,t);let u=_p(t),c=fl(i,t);return l?Pu(s,u,c):Fu(o,s,u,c)}case yo:return qt(Kn,e,t,r,null),F(t.data);default:return null}},dp=["input","select","textarea"],pp=(e,t)=>{let n=t.value,r=t.checked;e==="input"&&t.type==="checkbox"&&!r||e==="input"&&t.type==="radio"&&!r||t.type!=="checkbox"&&t.type!=="radio"&&!n||queueMicrotask(()=>{t.value=n,t.checked=r,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),Le().activeElement!==t&&t.dispatchEvent(new Event("blur",{bubbles:!0}))})},fl=(e,t)=>{let n=null,r=t.firstChild,i=null,s=0;for(;r;){let o=r.nodeType===gi?r.getAttribute("data-lustre-key"):null;o!=null&&r.removeAttribute("data-lustre-key");let l=fp(e,r,o,s),u=r.nextSibling;if(l){let c=new Fe([o??"",l],null);i?i=i.tail=c:i=n=c,s+=1}else t.removeChild(r);r=u}return i?(i.tail=q,n):q},_p=e=>{let t=e.attributes.length,n=q;for(;t-- >0;){let r=e.attributes[t];r.name!=="xmlns"&&(n=new Fe(hp(r),n))}return n},hp=e=>{let t=e.localName,n=e.value;return W(t,n)};var tr=()=>!!Le();var er=class{constructor(t,[n,r],i,s){this.root=t,this.#e=n,this.#n=i,this.#r=s,this.root.addEventListener("context-request",o=>{if(!(o.context&&o.callback)||!this.#s.has(o.context))return;o.stopImmediatePropagation();let l=this.#s.get(o.context);if(o.subscribe){let u=()=>{l.subscribers=l.subscribers.filter(c=>c!==o.callback)};l.subscribers.push([o.callback,u]),o.callback(l.value,u)}else o.callback(l.value)}),this.#d=new Ii(this.root,(o,l,u)=>{let[c,f]=Bi(this.#t,l,u,o);if(this.#t=c,f.isOk()){let d=f[0];d.stop_propagation&&o.stopPropagation(),d.prevent_default&&o.preventDefault(),this.dispatch(d.message,!1)}}),this.#i=Uu(this.root),this.#t=wu(),this.#l=!0,this.#f(r)}root=null;dispatch(t,n=!1){if(this.#l||=n,this.#a)this.#p.push(t);else{let[r,i]=this.#r(this.#e,t);this.#e=r,this.#f(i)}}emit(t,n){(this.root.host??this.root).dispatchEvent(new CustomEvent(t,{detail:n,bubbles:!0,composed:!0}))}provide(t,n){if(!this.#s.has(t))this.#s.set(t,{value:n,subscribers:[]});else{let r=this.#s.get(t);r.value=n;for(let i=r.subscribers.length-1;i>=0;i--){let[s,o]=r.subscribers[i];if(!s){r.subscribers.splice(i,1);continue}s(n,o)}}}#e;#n;#r;#i;#t;#d;#s=new Map;#a=!1;#p=[];#o=q;#u=q;#c=null;#l=!1;#_={dispatch:(t,n)=>this.dispatch(t,n),emit:(t,n)=>this.emit(t,n),select:()=>{},root:()=>this.root,provide:(t,n)=>this.provide(t,n)};#f(t){for(this.#a=!0;;){for(let n=t.synchronous;n.tail;n=n.tail)n.head(this.#_);if(this.#o=Yu(this.#o,t.before_paint),this.#u=Yu(this.#u,t.after_paint),!this.#p.length)break;[this.#e,t]=this.#r(this.#e,this.#p.shift())}this.#a=!1,this.#l?(cancelAnimationFrame(this.#c),this.#h()):this.#c||(this.#c=requestAnimationFrame(()=>{this.#h()}))}#h(){this.#l=!1,this.#c=null;let t=this.#n(this.#e),{patch:n,events:r}=ol(this.#t,this.#i,t);if(this.#t=r,this.#i=t,this.#d.push(n),this.#o instanceof Fe){let i=Gu(this.#o);this.#o=q,queueMicrotask(()=>{this.#l=!0,this.#f(i)})}if(this.#u instanceof Fe){let i=Gu(this.#u);this.#u=q,requestAnimationFrame(()=>{this.#l=!0,this.#f(i)})}}};function Gu(e){return{synchronous:e,after_paint:q,before_paint:q}}function Yu(e,t){return e instanceof y?t:t instanceof y?e:Oe(e,t)}var Xu=new WeakMap;async function Vu(e){let t=[];for(let r of Le().querySelectorAll("link[rel=stylesheet], style"))r.sheet||t.push(new Promise((i,s)=>{r.addEventListener("load",i),r.addEventListener("error",s)}));if(await Promise.allSettled(t),!e.host.isConnected)return[];e.adoptedStyleSheets=e.host.getRootNode().adoptedStyleSheets;let n=[];for(let r of Le().styleSheets)try{e.adoptedStyleSheets.push(r)}catch{try{let i=Xu.get(r);if(!i){i=new CSSStyleSheet;for(let s of r.cssRules)i.insertRule(s.cssText,i.cssRules.length);Xu.set(r,i)}e.adoptedStyleSheets.push(i)}catch{let i=r.ownerNode.cloneNode();e.prepend(i),n.push(i)}}return n}var Ni=class extends Event{constructor(t,n,r){super("context-request",{bubbles:!0,composed:!0}),this.context=t,this.callback=n,this.subscribe=r}};var Zt=class extends p{constructor(t){super(),this.message=t}},vn=class extends p{constructor(t,n){super(),this.name=t,this.data=n}};var en=class extends p{};var qr=({init:e,update:t,view:n,config:r},i)=>{if(!tr())return new A(new kn);if(!i.includes("-"))return new A(new Wi(i));if(customElements.get(i))return new A(new Pi(i));let s=new Map,o=[];for(let f=r.attributes;f.tail;f=f.tail){let[d,_]=f.head;s.has(d)||(s.set(d,_),o.push(d))}let[l,u]=e(void 0),c=class extends HTMLElement{static get observedAttributes(){return o}static formAssociated=r.is_form_associated;#e;#n=[];#r;#i=new Map;constructor(){super(),this.internals=this.attachInternals(),this.internals.shadowRoot?this.#r=this.internals.shadowRoot:this.#r=this.attachShadow({mode:r.open_shadow_root?"open":"closed",delegatesFocus:r.delegates_focus}),r.adopt_styles&&this.#t(),this.#e=new er(this.#r,[l,u],n,t)}connectedCallback(){let d=new Set;for(let _=r.contexts;_.tail;_=_.tail){let[m,w]=_.head;m&&(d.has(m)||(this.dispatchEvent(new Ni(m,(j,x)=>{let S=this.#i.get(m);S!==x&&S?.();let b=Ze(j,w);this.#i.set(m,x),b.isOk()&&this.dispatch(b[0])},!0)),d.add(m)))}}adoptedCallback(){r.adopt_styles&&this.#t()}attributeChangedCallback(d,_,m){let w=s.get(d)(m??"");w.isOk()&&this.dispatch(w[0])}formResetCallback(){r.on_form_reset instanceof Q&&this.dispatch(r.on_form_reset[0])}formStateRestoreCallback(d,_){switch(_){case"restore":r.on_form_restore instanceof Q&&this.dispatch(r.on_form_restore[0](d));break;case"autocomplete":r.on_form_populate instanceof Q&&this.dispatch(r.on_form_autofill[0](d));break}}disconnectedCallback(){for(let[d,_]of this.#i)_?.();this.#i.clear()}send(d){switch(d.constructor){case Zt:{this.dispatch(d.message,!1);break}case vn:{this.emit(d.name,d.data);break}case en:break}}dispatch(d,_=!1){this.#e.dispatch(d,_)}emit(d,_){this.#e.emit(d,_)}provide(d,_){this.#e.provide(d,_)}async#t(){for(;this.#n.length;)this.#n.pop().remove(),this.shadowRoot.firstChild.remove();this.#n=await Vu(this.#r)}};for(let f=r.properties;f.tail;f=f.tail){let[d,_]=f.head;Object.hasOwn(c.prototype,d)||Object.defineProperty(c.prototype,d,{get(){return this[`_${d}`]},set(m){this[`_${d}`]=m;let w=Ze(m,_);w.constructor===$&&this.dispatch(w[0])}})}return customElements.define(i,c),new $(void 0)};var dl=class extends p{constructor(t,n,r,i,s,o,l,u,c,f){super(),this.open_shadow_root=t,this.adopt_styles=n,this.delegates_focus=r,this.attributes=i,this.properties=s,this.contexts=o,this.is_form_associated=l,this.on_form_autofill=u,this.on_form_reset=c,this.on_form_restore=f}};function Ku(e){let t=new dl(!0,!0,!1,q,q,q,!1,bi,bi,bi);return lt(e,t,(n,r)=>r.apply(n))}var pl=class{#e;constructor(t,[n,r],i,s){this.#e=new er(t,[n,r],s,i)}send(t){switch(t.constructor){case Zt:{this.dispatch(t.message,!1);break}case vn:{this.emit(t.name,t.data);break}case en:break}}dispatch(t,n){this.#e.dispatch(t,n)}emit(t,n){this.#e.emit(t,n)}},Zu=({init:e,update:t,view:n},r,i)=>{if(!tr())return new A(new kn);let s=r instanceof HTMLElement?r:Le().querySelector(r);return s?new $(new pl(s,e(i),t,n)):new A(new Fi(r))};var _l=class extends p{constructor(t,n,r,i){super(),this.init=t,this.update=n,this.view=r,this.config=i}};var Wi=class extends p{constructor(t){super(),this.name=t}},Pi=class extends p{constructor(t){super(),this.name=t}},Fi=class extends p{constructor(t){super(),this.selector=t}},kn=class extends p{};function Dr(e,t,n){return new _l(e,t,n,Ku(q))}function ec(e,t,n){return Dr(s=>[e(s),E()],(s,o)=>[t(s,o),E()],n)}function tc(e,t,n){return mo(!tr(),new A(new kn),()=>Zu(e,t,n))}var nc="http://www.w3.org/2000/svg";function jn(e,t){return Oi(nc,"svg",e,t)}function En(e){return Oi(nc,"path",e,q)}function ic(e,t){return[e,t]}function bp(e){return e==="input"||e==="change"||e==="focus"||e==="focusin"||e==="focusout"||e==="blur"?!0:e==="select"}function ml(e,t){return ou(e,dn(t,n=>new Yn(!1,!1,n)),q,Ao,Ao,bp(e),0,0)}function vp(e){return e instanceof Ce?new Ce(e.kind,e.name,e.handler,e.include,lu,e.stop_propagation,e.immediate,e.debounce,e.throttle):e}function he(e){return ml("click",ge(e))}function Ri(e){return ml("change",Un(a(["target","value"]),ee,t=>ge(e(t))))}function kp(){let t=L(0,ee,r=>L(1,fo(dn(ee,i=>new $(i)),a([ge(new A(void 0))])),i=>{let o=_i(i,l=>ic(r,l));return ge(o)})),n=Me(t);return dn(n,Ga)}function tn(e){let t=ml("submit",Un(a(["detail","formData"]),kp(),n=>{let i=e(n);return ge(i)}));return vp(t)}var nr=class extends p{constructor(t,n,r,i){super(),this.translator=t,this.values=n,this.errors=r,this.run=i}},Ui=class extends p{constructor(t){super(),this.run=t}},Hi=class extends p{},Gi=class extends p{},Yi=class extends p{},xl=class extends p{},wl=class extends p{},yl=class extends p{},gl=class extends p{},bl=class extends p{},vl=class extends p{},kl=class extends p{},jl=class extends p{constructor(t){super(),this.limit=t}},El=class extends p{constructor(t){super(),this.limit=t}},Sl=class extends p{constructor(t){super(),this.limit=t}},Al=class extends p{constructor(t){super(),this.limit=t}},Cl=class extends p{constructor(t){super(),this.limit=t}},Tl=class extends p{constructor(t){super(),this.limit=t}},Bl=class extends p{},zl=class extends p{},Ol=class extends p{},ql=class extends p{constructor(t){super(),this.message=t}},Sn=class extends p{constructor(t){super(),this.run=t}},Xi=class extends p{},Vi=class extends p{};function H(e,t){let n=e.values,r=va(n,t);return Gt(r,"")}function An(e){let t=e.run(e.values,a([])),n,r;return n=t[0],r=t[1],r instanceof y?new $(n):new A(new nr(e.translator,e.values,r,e.run))}function de(e,t,n){return new Ui((r,i)=>{let s=oo(r,e),o=t.run(s,new Xi),l,u;l=o[0],u=o[2];let c;u instanceof y?c=i:c=h([e,u],i);let f=c;return n(l).run(r,f)})}function Dt(e){return new Ui((t,n)=>[e,n])}function Cn(e,t){return new nr(e.translator,Oe(t,e.values),e.errors,e.run)}function De(e,t){return new nr(e.translator,t,e.errors,e.run)}function Ap(e,t){return e instanceof y?[!1,t,a([])]:[!0,t,a([])]}function Cp(e,t){return e instanceof y?["",t,a([])]:[e.head,t,a([])]}function sc(e,t,n,r,i){if(e instanceof y)return[t,new Vi,a([r])];{let s=e.head,o=i(s);return o instanceof $?[o[0],n,a([])]:[t,new Vi,a([r])]}}function Tp(e,t){return sc(e,0,t,new Gi,n=>ri(n))}function Bp(e,t){return sc(e,0,t,new Yi,n=>{let r=In(n);if(r instanceof $)return r;{let i=ri(n);return _i(i,ae)}})}function oc(e,t){return new Sn((n,r)=>{let i=e.run(n,r),s,o,l;s=i[0],o=i[1],l=i[2];let u;if(o instanceof Xi){let f=t(s);if(f instanceof $)u=l;else{let d=f[0];u=h(d,l)}}else u=l;return[s,o,u]})}function vt(e,t){return oc(e,n=>{let r=t(n);if(r instanceof $)return r;{let i=r[0];return new A(new ql(i))}})}function Mt(e){return oc(e,t=>t===""?new A(new Hi):new $(t))}function zp(e){if(e instanceof Hi)return"must not be blank";if(e instanceof Gi)return"must be a whole number";if(e instanceof Yi)return"must be a number";if(e instanceof xl)return"must be an email";if(e instanceof wl)return"must be a phone number";if(e instanceof yl)return"must be a URL";if(e instanceof gl)return"must be a date";if(e instanceof bl)return"must be a time";if(e instanceof vl)return"must be a date and time";if(e instanceof kl)return"must be a hex colour code";if(e instanceof jl){let t=e.limit;return"must be more than "+re(t)+" characters"}else if(e instanceof El){let t=e.limit;return"must be less than "+re(t)+" characters"}else if(e instanceof Sl){let t=e.limit;return"must be more than "+re(t)}else if(e instanceof Al){let t=e.limit;return"must be less than "+re(t)}else if(e instanceof Cl){let t=e.limit;return"must be more than "+Ue(t)}else if(e instanceof Tl){let t=e.limit;return"must be less than "+Ue(t)}else return e instanceof Bl?"must be accepted":e instanceof zl?"doesn't match":e instanceof Ol?"is already in use":e.message}function Lt(e){return new nr(zp,a([]),a([]),e.run)}function nn(e,t){let n=e.errors,r=oo(n,t);return yr(r,i=>R(i,e.translator))}var Ji=new Sn(Ap),Ye=new Sn(Cp),Ki=new Sn(Tp),Qi=new Sn(Bp);var qp=navigator.platform&&navigator.platform.toLowerCase().startsWith("mac")||navigator.platform&&navigator.platform.toLowerCase().startsWith("iphone")||navigator.userAgent&&/mac/i.test(navigator.userAgent.toLowerCase())||navigator.userAgent?.platform?.startsWith("mac"),ac=(e,t)=>{window.addEventListener(e,t)},uc=e=>{e.preventDefault()},cc=()=>qp;var Mr=class extends p{constructor(t,n,r){super(),this.combination=t,this.msg=n,this.options=r}},rr=class extends p{},Dl=class extends p{constructor(t){super(),this[0]=t}},Ml=class extends p{},ir=class extends p{constructor(t){super(),this[0]=t}},Ll=class extends p{constructor(t){super(),this[0]=t}},Lr=class extends p{},Il=class extends p{},Nl=class extends p{},Ir=class extends p{};var Zi=class extends p{constructor(t,n,r,i,s){super(),this.key=t,this.mod=n,this.shift=r,this.alt=i,this.code=s}},Wl=class extends p{constructor(t,n){super(),this.key=t,this.tag_name=n}},Pl=class extends p{constructor(t,n,r,i){super(),this.trigger=t,this.msg=n,this.prevent_default=r,this.exclude=i}};function Dp(e){let t=St(e,new Lr),n=St(e,new Il),r=St(e,new Nl),i,s=ii(e,f=>{if(f instanceof ir){let d=f[0];return new $(d)}else return new A("not found")});if(s instanceof $){let f=s[0];i=At(f)}else i="NOTMATCHING";let o=i,l,u=ii(e,f=>{if(f instanceof Ll){let d=f[0];return new $(d)}else return new A("not found")});if(u instanceof $){let f=u[0];l=At(f)}else l="NOTMATCHING";let c=l;return new Zi(o,t,n,r,c)}function Mp(e,t){return e.mod===t.mod&&e.shift===t.shift&&e.alt===t.alt}function Lp(e,t){return e.key===t.key||e.code===t.code}function Ip(){return cc()?"metaKey":"ctrlKey"}var Np=a(["INPUT","TEXTAREA","SELECT"]);function fc(e,t,n){let r;t instanceof Ir?r="keydown":r="keyup";let i=r,s=Ip(),o=R(n,l=>{let u=Dp(l.combination),c=St(l.options,new rr),f,d=fn(l.options,m=>{if(m instanceof Dl){let w=m[0];return new $(a([w]))}else return m instanceof Ml?new $(Np):new A(void 0)});f=Wn(d);let _=f;return new Pl(u,l.msg,c,_)});return ac(i,l=>{let u=Ze(l,L("key",ee,c=>L(s,pn,f=>L("shiftKey",pn,d=>L("altKey",pn,_=>L("code",ee,m=>Un(a(["target","tagName"]),ee,w=>ge(new Wl(new Zi(At(c),f,d,_,At(m)),w)))))))));if(u instanceof $){let c=u[0],f=ke(o,d=>Mp(d.trigger,c.key)&&Lp(d.trigger,c.key)&&!St(d.exclude,c.tag_name));if(f instanceof $){let d=f[0];return d.prevent_default&&uc(l),e(d.msg)}else return}else{let c=u[0];return}})}var be={nodeRadius:1.5,arrowOffset:2.5,mapHeight:.6,animationDuration:150,pathAnimationDuration:300,hoverDuration:200,bundleBeta:.85,alphaDecay:.1,forceStrength:.5,chargeDistanceMax:50,hoverStrokeWidth:2.5},Wr={pathThickness:d3.scaleLinear().range([.2,1.2]),segments:d3.scaleLinear().domain([0,500]).range([1,8])},Xe={node:"#ef4444",nodeStroke:"#ffffff",tempNode:"#6b7280",path:"#3b82f6",country:"#9ca3af",countryStroke:"#f3f4f6",text:"#1f2937",labelBackground:"rgba(255, 255, 255, 0)",labelBackgroundHover:"rgba(255, 255, 255, 0.5)",labelBackgroundDrag:"rgba(255, 255, 255, 0.8)"},Nr={fontFamily:"Arial, sans-serif",fontSize:"4px",strokeWidth:{node:.5,country:.25}},v={svg:null,g:null,countries:null,nodesList:null,pathsList:null,projection:null,tempNode:null,forceLayout:null,initialised:!1,bundleData:{nodes:[],links:[],paths:[]}},It=null;function es(){return v.initialised||requestAnimationFrame(()=>{let e=document.querySelector("flow-map");if(e.closest(".hidden")!==null){es();return}e.shadowRoot?.getElementById("flow-map")?(w_(),v.initialised=!0):es()}),null}function _c(e){return It=e,null}function sr(e,t,n,r){if(!bc())return requestAnimationFrame(()=>sr(e,t,n,r)),null;Nt(),h_(e);let[i,s]=v.projection([n,t]),o=Wp(e,i,s);return Pp(o,r),Up(o,e),Gp(o),null}function ts(e,t,n,r){if(!bc())return requestAnimationFrame(()=>ts(e,t,n,r)),null;Nt();let i=v.nodesList?.select(`#${e}`);if(!i||i.empty())return console.warn(`Node with id ${e} not found`),null;let[s,o]=v.projection([n,t]);return Xp(i,s,o),Vp(i,r),u_(e,t,n),null}function Fl(e){if(!v.initialised||!v.nodesList)return console.warn("Cannot delete node: map not initialised or no nodes exist"),null;let t=v.nodesList.select(`#${e}`);return!t||t.empty()?(console.warn(`Node with id ${e} not found`),null):(Yp(t),null)}function or(e,t,n,r){if(!vc())return requestAnimationFrame(()=>or(e,t,n,r)),null;Nt();let{originCoords:i,destinationCoords:s}=jc(t,n);return!i||!s?(console.warn(`Cannot create path: nodes ${t} or ${n} not found`),null):(__(),m_(e),xc(e,i,s,t,n,r),rs(),null)}function Rl(e,t,n,r){if(!vc())return null;Nt();let{originCoords:i,destinationCoords:s}=jc(t,n);return!i||!s?(console.warn(`Cannot edit path: nodes ${t} or ${n} not found`),null):(a_(e,i,s,t,n,r),rs(),null)}function ns(e){if(!v.initialised||!v.pathsList)return console.warn("Cannot delete path: map not initialised or no paths exist"),null;Nt();let t=v.pathsList.select(`#${e}`);return t.empty()?console.warn(`Path with id ${e} not found`):(l_(t),Gl(e),rs()),null}function Nt(){v.tempNode&&(v.tempNode.remove(),v.tempNode=null)}function hc(e){let t=JSON.parse(e),n={nodes:[],paths:[]};v.nodesList&&v.nodesList.selectAll(".node").each(function(){let u=d3.select(this),c=u.attr("id"),d=u.attr("transform").match(/translate\(([^,]+),([^)]+)\)/);if(d&&v.projection){let _=parseFloat(d[1]),m=parseFloat(d[2]),[w,j]=v.projection.invert([_,m]),S=u.select(".label-group").select("text"),b=parseFloat(S.attr("dx"))||0,C=parseFloat(S.attr("dy"))||-6;n.nodes.push({id:c,lat:j,lon:w,x:_,y:m,labelDx:b,labelDy:C})}}),v.pathsList&&v.pathsList.selectAll(".flow").each(function(){let c=d3.select(this).attr("id");n.paths.push({id:c})});let i=JSON.stringify({gleam_state:t,d3_state:n},null,2),s=new Blob([i],{type:"application/json"}),o=URL.createObjectURL(s),l=document.createElement("a");l.href=o,l.download=`flow-map-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o)}function Ul(e){requestAnimationFrame(()=>{let n=document.querySelector("flow-map").shadowRoot.querySelector("#import-file");if(!n){Ul(e);return}n.addEventListener("change",r=>{let i=r.target.files[0];if(i){let s=new FileReader;s.onload=o=>{try{let l=JSON.parse(o.target.result);l.d3_state&&l.gleam_state?(window.pendingD3State=l.d3_state,e(`import:${JSON.stringify(l.gleam_state)}`)):console.error("Invalid file format")}catch(l){console.error("Failed to parse import file:",l)}},s.readAsText(i)}})})}function mc(e,t){if(!window.pendingD3State)return;let n=window.pendingD3State;x_(),e.toArray().forEach(r=>{let i=n.nodes.find(s=>s.id===r.node_id);sr(r.node_id,r.lat,r.lon,r.node_label),i&&(i.labelDx!==0||i.labelDy!==-6)&&requestAnimationFrame(()=>{let s=v.nodesList.select(`#${r.node_id}`);if(!s.empty()){let o=s.select(".label-group"),l=o.select("text"),u=o.select("rect");if(l.attr("dx",i.labelDx).attr("dy",i.labelDy),!u.empty()){let c=l.node().getBBox();u.attr("x",c.x-1).attr("y",c.y-1).attr("width",c.width+2).attr("height",c.height+2)}}})}),t.toArray().forEach(r=>{or(r.path_id,r.origin_node_id,r.destination_node_id,r.value)}),delete window.pendingD3State}function Wp(e,t,n){return kc(),v.nodesList.append("g").attr("class","node").attr("id",e).attr("transform",`translate(${t}, ${n})`)}function Pp(e,t){Fp(e),Rp(e,t)}function Fp(e){e.append("circle").attr("r",be.nodeRadius).attr("stroke",Xe.nodeStroke).attr("stroke-width",Nr.strokeWidth.node).attr("fill",Xe.node).style("cursor","pointer")}function Rp(e,t){let n=e.append("g").attr("class","label-group"),r=n.append("text").attr("dy",-6).attr("text-anchor","middle").style("font-size",Nr.fontSize).style("font-family",Nr.fontFamily).style("fill",Xe.text).style("cursor","pointer").text(t);t&&t.trim()!==""&&$c(n,r),Hp(n,r)}function $c(e,t){let n=t.node().getBBox();return e.insert("rect","text").attr("x",n.x-1).attr("y",n.y-1).attr("width",n.width+2).attr("height",n.height+2).attr("fill",Xe.labelBackground).attr("rx",2).style("cursor","move")}function Up(e,t){e.on("mouseover",function(){dc(d3.select(this),!0)}).on("mouseout",function(){dc(d3.select(this),!1)}).on("mousedown",function(n){n.target.tagName==="circle"&&(n.stopPropagation(),It&&It("node_id:"+t))})}function Hp(e,t){let n=e.node().parentNode.id,r=Hl(n);t.call(r);let i=e.select("rect");i.empty()||i.call(r)}function dc(e,t){let n=t?2:1,r=t?.5:0;e.select("circle").transition().duration(be.hoverDuration).attr("r",be.nodeRadius*n),e.select(".label-group rect").transition().duration(be.hoverDuration).attr("fill",t?Xe.labelBackgroundHover:Xe.labelBackground)}function Gp(e){e.style("opacity",0).transition().duration(be.animationDuration).style("opacity",1)}function Yp(e){e.transition().duration(be.animationDuration).style("opacity",0).remove()}function Xp(e,t,n){e.transition().duration(be.animationDuration).attr("transform",`translate(${t}, ${n})`)}function Vp(e,t){let n=e.select(".label-group"),r=n.select("text"),i=parseFloat(r.attr("dx"))||0,s=parseFloat(r.attr("dy"))||-6;r.text(t).attr("dx",i).attr("dy",s),Jp(n,r,t),Kp(n,r)}function Jp(e,t,n){let r=e.select("rect");if(n&&n.trim()!==""){let i=t.node().getBBox();if(r.empty()){r=$c(e,t);let s=e.node().parentNode.id,o=Hl(s);r.call(o)}r.attr("x",i.x-1).attr("y",i.y-1).attr("width",i.width+2).attr("height",i.height+2)}else r.empty()||r.remove()}function Kp(e,t){let n=e.node().parentNode.id;if(!t.node().__on){let r=Hl(n);t.call(r);let i=e.select("rect");i.empty()||i.call(r)}}function Hl(e){return d3.drag().on("start",function(t){t.sourceEvent.stopPropagation(),d3.select(this.parentNode).select("rect").transition().duration(100).attr("fill",Xe.labelBackgroundDrag)}).on("drag",function(t){let n=d3.select(this.parentNode),r=n.select("text"),i=n.select("rect");if(r.attr("dx",t.x).attr("dy",t.y),!i.empty()){let s=r.node().getBBox();i.attr("x",s.x-1).attr("y",s.y-1).attr("width",s.width+2).attr("height",s.height+2)}}).on("end",function(t){d3.select(this.parentNode).select("rect").transition().duration(100).attr("fill",Xe.labelBackground);let n=d3.select(this),r=parseFloat(n.attr("dx"))||0,i=parseFloat(n.attr("dy"))||-6;It&&It(`label_moved:${e}:${r}:${i}`)})}function Qp(e,t){kc(),v.tempNode=v.nodesList.append("circle").attr("cx",e).attr("cy",t).attr("r",be.nodeRadius).attr("fill",Xe.tempNode).attr("stroke",Xe.nodeStroke).attr("stroke-width",Nr.strokeWidth.node).attr("opacity",.7)}function Zp(){let e=d3.line().curve(d3.curveBundle.beta(be.bundleBeta)).x(r=>r.x).y(r=>r.y);e_();let t=t_(e),n=n_(e);return{hoverAreas:t,visiblePaths:n,line:e}}function e_(){v.pathsList.selectAll("path.flow").remove(),v.pathsList.selectAll("path.flow-hover").remove()}function t_(e){return v.pathsList.selectAll("path.flow-hover").data(v.bundleData.paths).enter().append("path").attr("d",t=>e(t.segments)).attr("class","flow-hover").attr("fill","none").attr("stroke","transparent").attr("stroke-width",be.hoverStrokeWidth).style("cursor","pointer").on("mouseover",r_).on("mouseout",i_).on("click",s_)}function n_(e){return v.pathsList.selectAll("path.flow").data(v.bundleData.paths).enter().append("path").attr("d",t=>e(t.segments)).attr("class","flow").attr("id",t=>t.id).attr("fill","none").attr("stroke",Xe.path).attr("stroke-width",t=>Wr.pathThickness(t.value)).style("pointer-events","none")}function r_(e,t){v.pathsList.select(`path.flow#${t.id}`).transition().duration(be.hoverDuration).attr("stroke-width",Wr.pathThickness(t.value)+1)}function i_(e,t){v.pathsList.select(`path.flow#${t.id}`).transition().duration(be.hoverDuration).attr("stroke-width",Wr.pathThickness(t.value))}function s_(e,t){e.stopPropagation(),Nt(),It&&It("path_id:"+t.id)}function o_(e){let t=e.nodes().map(n=>n.getTotalLength());e.attr("stroke-dasharray",(n,r)=>`${t[r]} ${t[r]}`).attr("stroke-dashoffset",(n,r)=>t[r]).transition().duration(be.pathAnimationDuration).attr("stroke-dashoffset",0).on("end",function(){d3.select(this).attr("stroke-dasharray","none")})}function l_(e){e.transition().duration(be.animationDuration).style("opacity",0).remove()}function xc(e,t,n,r,i,s){let o={id:e,source:{...t,id:r,fx:t.x,fy:t.y},target:{...n,id:i,fx:n.x,fy:n.y}},l=gc(o);v.bundleData.paths.push({id:e,value:s,segments:l.local,source:o.source,target:o.target}),v.bundleData.nodes.push(...l.nodes),v.bundleData.links.push(...l.links)}function a_(e,t,n,r,i,s){if(v.bundleData.paths.findIndex(l=>l.id===e)===-1){console.warn(`Path ${e} not found for editing`);return}Gl(e),xc(e,t,n,r,i,s)}function Gl(e){let t=v.bundleData.paths.findIndex(r=>r.id===e);if(t===-1)return;let n=v.bundleData.paths[t];wc(n),yc(n),v.bundleData.paths.splice(t,1)}function wc(e){e.segments.forEach(t=>{if(t.generated){let n=v.bundleData.nodes.findIndex(r=>r===t);n!==-1&&v.bundleData.nodes.splice(n,1)}})}function yc(e){v.bundleData.links=v.bundleData.links.filter(t=>!e.segments.includes(t.source)&&!e.segments.includes(t.target))}function gc(e){let t=$_(e.source,e.target),n=Math.round(Wr.segments(t)),r=d3.scaleLinear().domain([0,n+1]).range([e.source.x,e.target.x]),i=d3.scaleLinear().domain([0,n+1]).range([e.source.y,e.target.y]),s=e.source,o=[s],l=[],u=[];for(let c=1;c<=n;c++){let f={x:r(c),y:i(c),generated:!0};o.push(f),l.push(f),u.push({source:s,target:f}),s=f}return o.push(e.target),u.push({source:s,target:e.target}),{local:o,nodes:l,links:u}}function u_(e,t,n){let r=v.bundleData.paths.filter(l=>l.source.id===e||l.target.id===e);if(r.length===0)return;let[i,s]=v.projection([n,t]),o={x:i,y:s};r.forEach(l=>{c_(l,e,o,i,s),f_(l)}),rs()}function c_(e,t,n,r,i){let s=v.bundleData.paths.findIndex(o=>o.id===e.id);if(s!==-1){let o=v.bundleData.paths[s];wc(o),yc(o)}e.source.id===t&&(e.source={...n,id:t,fx:r,fy:i}),e.target.id===t&&(e.target={...n,id:t,fx:r,fy:i})}function f_(e){let t=gc({id:e.id,source:e.source,target:e.target});e.segments=t.local,v.bundleData.nodes.push(...t.nodes),v.bundleData.links.push(...t.links)}function rs(){if(v.bundleData.paths.length===0){Yl();return}d_();let{hoverAreas:e,visiblePaths:t,line:n}=Zp();p_(t,e,n),o_(t)}function d_(){let e=v.bundleData.paths.reduce((t,n)=>t+n.value,0);Wr.pathThickness.domain([0,e])}function p_(e,t,n){Yl(),v.forceLayout=d3.forceSimulation().alphaDecay(be.alphaDecay).randomSource(d3.randomLcg(42)).force("charge",d3.forceManyBody().strength(be.forceStrength).distanceMax(be.chargeDistanceMax)).force("link",d3.forceLink().strength(be.forceStrength).distance(1)).on("tick",function(){e.attr("d",r=>n(r.segments)),t.attr("d",r=>n(r.segments))}),v.forceLayout.nodes(v.bundleData.nodes).force("link").links(v.bundleData.links)}function Yl(){v.forceLayout&&v.forceLayout.stop()}function bc(){return v.initialised&&v.projection}function vc(){return v.initialised&&v.projection&&v.nodesList}function kc(){v.nodesList||(v.nodesList=v.g.append("g").attr("class","nodes"))}function __(){v.pathsList||(v.pathsList=v.g.insert("g",".nodes").attr("class","paths"))}function h_(e){let t=v.nodesList?.select(`#${e}`);t&&!t.empty()&&t.remove()}function m_(e){let t=v.pathsList?.select(`#${e}`);t&&!t.empty()&&(t.remove(),Gl(e))}function jc(e,t){let n=v.nodesList.select(`#${e}`),r=v.nodesList.select(`#${t}`);if(n.empty()||r.empty())return{originCoords:null,destinationCoords:null};let i=pc(n.attr("transform")),s=pc(r.attr("transform"));return{originCoords:i,destinationCoords:s}}function pc(e){if(!e)return null;let t=e.match(/translate\(([^,]+),([^)]+)\)/);return t?{x:parseFloat(t[1]),y:parseFloat(t[2])}:null}function $_(e,t){let n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function x_(){v.g&&(v.g.selectAll(".node").remove(),v.g.selectAll(".flow").remove(),v.bundleData={nodes:[],links:[],paths:[]},Yl())}function w_(){let e=document.querySelector("flow-map").shadowRoot,t=e.getElementById("flow-map"),n=t.clientWidth,r=window.innerHeight*be.mapHeight;y_(e,n,r),g_(),b_(),k_(n,r),j_(n,r),window.addEventListener("resize",()=>{let i=t.clientWidth,s=window.innerHeight*.6;v.svg.style("width",i).attr("height",s)})}function y_(e,t,n){v.svg=d3.select(e.getElementById("flow-map")).append("svg").attr("width","100%").style("width",t).attr("height",n).style("cursor","crosshair"),v.g=v.svg.append("g")}function g_(){let e=d3.zoom().scaleExtent([.1,200]).on("zoom",t=>{v.g.attr("transform",t.transform)}).on("end",t=>{v.g.attr("transform",`${t.transform} translate(0, 0)`),requestAnimationFrame(()=>{v.g.attr("transform",t.transform)})});v.svg.call(e)}function b_(){v.svg.on("click",function(e){if(v_(e.target))return;let[t,n]=d3.pointer(e,v.g.node());if(v.projection){let[r,i]=v.projection.invert([t,n]);Nt(),Qp(t,n),It&&It(`coords:${i},${r}`)}})}function v_(e){return["circle","text","rect"].includes(e.tagName)}function k_(e,t){v.projection=d3.geoNaturalEarth1()}function j_(e,t){let n=d3.geoPath().projection(v.projection);d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json").then(r=>{v.countries=topojson.feature(r,r.objects.countries),v.projection.fitSize([e,t],v.countries),E_(n)})}function E_(e){v.g.selectAll("path").data(v.countries.features).enter().append("path").attr("d",e).attr("fill",Xe.country).attr("stroke",Xe.countryStroke).attr("stroke-width",Nr.strokeWidth.country)}function lr(e,t){return requestAnimationFrame(()=>{let r=document.querySelector(e)?.shadowRoot?.getElementById(t);r?r.focus():r||lr(e,t)}),null}var X=class extends p{constructor(t,n,r,i,s,o,l,u,c){super(),this.form=t,this.current_form=n,this.actions=r,this.next_node_id=i,this.next_path_id=s,this.nodes=o,this.paths=l,this.selected_coords=u,this.selected_node=c}},ss=class extends p{constructor(t,n){super(),this.lat=t,this.lon=n}},os=class extends p{constructor(t){super(),this.node_id=t}},Pr=class extends p{constructor(t){super(),this.node_id=t}},ls=class extends p{constructor(t){super(),this[0]=t}},Fr=class extends p{constructor(t){super(),this.path_id=t}},as=class extends p{constructor(t){super(),this[0]=t}},Rr=class extends p{constructor(t){super(),this.node_id=t}},us=class extends p{constructor(t){super(),this.path_id=t}},Ur=class extends p{},cs=class extends p{},fs=class extends p{},Xl=class extends p{constructor(t){super(),this.json_data=t}},ar=class extends p{constructor(t,n,r,i){super(),this.node_id=t,this.lat=n,this.lon=r,this.node_label=i}},ur=class extends p{constructor(t,n,r,i){super(),this.path_id=t,this.origin_node_id=n,this.destination_node_id=r,this.value=i}},Tn=class extends p{},Wt=class extends p{constructor(t){super(),this.node_id=t}},rn=class extends p{},sn=class extends p{constructor(t){super(),this.node_id=t}},on=class extends p{},ds=class extends p{constructor(t,n,r){super(),this.lat=t,this.lon=n,this.node_label=r}},ps=class extends p{constructor(t,n,r){super(),this.origin_node_id=t,this.destination_node_id=n,this.value=r}},Vl=class extends p{},_s=class extends p{constructor(t){super(),this.node=t}},hs=class extends p{constructor(t,n){super(),this.new=t,this.previous=n}},ms=class extends p{constructor(t,n){super(),this.node=t,this.deleted_paths=n}},$s=class extends p{constructor(t){super(),this.path=t}},xs=class extends p{constructor(t,n){super(),this.new=t,this.previous=n}},Jl=class extends p{constructor(t){super(),this.path=t}};function Bc(){return Ee("flow-map",a([]),a([]))}function Kl(e,t){return ke(e.nodes,n=>n.node_id===t)}function Ec(e,t,n,r){let i="node-id-"+re(e.next_node_id),s=new ar(i,t,n,r);return[new X(e.form,e.current_form,h(new _s(s),e.actions),e.next_node_id+1,e.next_path_id,h(s,e.nodes),e.paths,new se,e.selected_node),s]}function S_(e,t,n,r,i){return at(Kl(e,t),s=>{let o=new ar(t,n,r,i),l=R(e.nodes,c=>c.node_id===t?o:c),u=new X(e.form,e.current_form,h(new hs(s,o),e.actions),e.next_node_id,e.next_path_id,l,e.paths,new se,e.selected_node);return new $(u)})}function A_(){return L("node_id",ee,e=>L("lat",di,t=>L("lon",di,n=>L("node_label",ee,r=>ge(new ar(e,t,n,r))))))}function C_(e,t,n,r){let i="path-id-"+re(e.next_path_id),s=new ur(i,t,n,r);return[new X(e.form,e.current_form,h(new $s(s),e.actions),e.next_node_id,e.next_path_id+1,e.nodes,h(s,e.paths),e.selected_coords,e.selected_node),s]}function Ql(e,t){return ke(e.paths,n=>n.path_id===t)}function T_(e,t){return we(e.paths,n=>n.origin_node_id===t||n.destination_node_id===t)}function B_(e,t,n,r,i){return at(Ql(e,t),s=>{let o=new ur(t,n,r,i),l=R(e.paths,c=>c.path_id===t?o:c),u=new X(e.form,e.current_form,h(new xs(s,o),e.actions),e.next_node_id,e.next_path_id,e.nodes,l,new se,e.selected_node);return new $(u)})}function z_(){return L("path_id",ee,e=>L("origin_node_id",ee,t=>L("destination_node_id",ee,n=>L("value",di,r=>ge(new ur(e,t,n,r))))))}function Hr(){let e=Dt(new Vl);return Lt(e)}function O_(){return L("nodes",Me(A_()),e=>L("paths",Me(z_()),t=>L("next_node_id",xt,n=>L("next_path_id",xt,r=>ge(new X(Hr(),new on,a([]),n,r,e,t,new se,new se))))))}function _t(e){return new X(Hr(),new on,e.actions,e.next_node_id,e.next_path_id,e.nodes,e.paths,e.selected_coords,e.selected_node)}function zc(){return Lt(de("lat",Qi,e=>de("lon",Qi,t=>de("node_label",Ye,n=>Dt(new ds(e,t,n))))))}function Sc(e){let t=zc();return De(t,a([["lat",Ue(e.lat)],["lon",Ue(e.lon)],["node_label",e.node_label]]))}function Zl(){return Lt(de("origin_node_id",Mt(Ye),e=>{let t=n=>n===e?new A("must not be origin"):new $(n);return de("destination_node_id",(()=>{let r=Mt(Ye);return vt(r,t)})(),n=>de("value",Qi,r=>Dt(new ps(e,n,r))))}))}function q_(e){let t=Zl();return De(t,a([["origin_node_id",e.origin_node_id],["destination_node_id",e.destination_node_id],["value",Ue(e.value)]]))}function is(e,t,n){let r=nn(e,t);return O(a([]),h(O(a([k("py-2")]),a([Pe(a([gt(t)]),a([F(n+": ")]))])),h(pt(a([k("w-full bg-gray-200 text-gray-700 rounded-sm px-2 py-1"),qe(t),Ne("text"),Ie(t),fe(H(e,t))])),R(r,i=>Kt(a([k("mt-0.5 text-xs text-red-300")]),a([Jt(i)]))))))}function D_(e){return e.actions instanceof y?zt():Te(a([k("bg-gray-600 hover:bg-gray-400 px-3 py-2 rounded-sm cursor-pointer ml-2"),he(new Ur)]),a([F("Undo")]))}function Ac(e,t,n,r){let i=nn(e,t);return O(a([]),h(O(a([k("py-2")]),a([Pe(a([gt(t)]),a([F(n+": ")]))])),h(yn(a([k("w-full bg-gray-200 text-gray-700 rounded-sm px-2 py-1"),qe(t),Ie(t)]),h(Ge(a([fe(""),ct(H(e,t)==="")]),"Select a node..."),R(r,s=>{let o=H(e,t)===s.node_id;return Ge(a([fe(s.node_id),ct(o)]),(()=>{let l=s.node_label,u=s.node_id;return u.startsWith("node-id-")&&l===""?"Node "+u.slice(8):s.node_label})())}))),R(i,s=>Kt(a([k("mt-0.5 text-xs text-red-300")]),a([Jt(s)]))))))}function Oc(e){let t;e instanceof Tn?t="Add Node":e instanceof Wt?t="Edit Node":e instanceof rn?t="Add Path":e instanceof sn?t="Edit Path":t="Submit";let n=t;return O(a([k("pt-4")]),a([Te(a([k("w-full bg-pink-600 hover:bg-pink-400 px-3 py-2 rounded-sm cursor-pointer")]),a([F(n)]))]))}function Cc(e,t){let n=r=>{let s=Cn(e,r),o=An(s);return new ls(o)};return O(a([k("flex-1 py-2")]),a([Qt(a([tn(n)]),a([is(e,"lat","Latitude"),is(e,"lon","Longitude"),is(e,"node_label","Label"),Oc(t)]))]))}function Tc(e,t,n){let r=s=>{let l=Cn(e,s),u=An(l);return new as(u)},i=G(t);return O(a([k("flex-1 py-2")]),a([Qt(a([tn(r)]),a([Ac(e,"origin_node_id","Origin",i),Ac(e,"destination_node_id","Destination",i),is(e,"value","Value"),Oc(n)]))]))}function M_(e){let t=e.current_form;return t instanceof Tn||t instanceof Wt?Cc(e.form,e.current_form):t instanceof rn||t instanceof sn?Tc(e.form,e.nodes,e.current_form):zt()}function L_(e){let t;if(e instanceof Wt){let s=e.node_id;t=[new Rr(s),"Delete Node"]}else if(e instanceof sn){let s=e.node_id;t=[new us(s),"Delete Path"]}else t=[new Rr(""),""];let n=t,r,i;return r=n[0],i=n[1],i===""?zt():Te(a([k("w-full bg-red-600 hover:bg-red-800 px-3 py-2 rounded-sm cursor-pointer"),he(r)]),a([F(i)]))}function I_(){return O(a([k("flex-1 mb-2")]),a([Te(a([k("bg-gray-600 hover:bg-gray-400 px-3 py-2 rounded-sm cursor-pointer"),he(new fs)]),a([F("Download")])),Pe(a([k("bg-gray-600 hover:bg-gray-400 px-3 py-2 rounded-sm cursor-pointer ml-2 inline-block"),gt("import-file")]),a([F("Import"),pt(a([qe("import-file"),Ne("file"),ji(a([".json"])),k("hidden")]))]))]))}function N_(e){return O(a([k("flex-1 bg-gray-700 text-gray-200 p-4 rounded-lg transition-all duration-300 ease-in-out")]),a([I_(),Te(a([k("bg-blue-600 hover:bg-blue-400 px-3 py-2 rounded-sm cursor-pointer"),he(new Pr(""))]),a([F("Add Node")])),Te(a([k("bg-green-600 hover:bg-green-400 px-3 py-2 rounded-sm cursor-pointer ml-2"),he(new Fr(""))]),a([F("Add Path")])),D_(e),O(a([k("transition-all duration-300 ease-in-out"),e.current_form instanceof on?k("max-h-0 opacity-0"):k("max-h-96 opacity-100")]),a([M_(e)])),L_(e.current_form)]))}function W_(e){return O(a([k("flex flex-1")]),a([O(a([k("flex-col w-2/3 p-4")]),a([O(a([k("flex-1 border-2 border-solid border-gray-900 rounded-lg p-1"),qe("flow-map")]),a([]))])),O(a([k("flex-col w-1/3 p-4")]),a([N_(e)]))]))}function P_(e){let t=ui(e,",");if(t instanceof y)return new A("Invalid coordinate string");{let n=t.tail;if(n instanceof y)return new A("Invalid coordinate string");if(n.tail instanceof y){let i=t.head,s=n.head;return at((()=>{let o=In(i);return jr(o,l=>"Invalid latitude")})(),o=>at((()=>{let l=In(s);return jr(l,u=>"Invalid longitude")})(),l=>new $([o,l])))}else return new A("Invalid coordinate string")}}function F_(e){return et(a([["node_id",_e(e.node_id)],["lat",wi(e.lat)],["lon",wi(e.lon)],["node_label",_e(e.node_label)]]))}function R_(e){return et(a([["path_id",_e(e.path_id)],["origin_node_id",_e(e.origin_node_id)],["destination_node_id",_e(e.destination_node_id)],["value",wi(e.value)]]))}function U_(e){let t=et(a([["nodes",He(e.nodes,F_)],["paths",He(e.paths,R_)],["next_node_id",wt(e.next_node_id)],["next_path_id",wt(e.next_path_id)]]));return xi(t)}function H_(e){return $i(e,O_())}function G_(e){let t=mn(n=>{es();let r=s=>{if(s.startsWith("node_id:")){let o=s.slice(8);return n(new os(o))}else if(s.startsWith("path_id:")){let o=s.slice(8);return n(new Fr(o))}else if(s.startsWith("coords:")){let o=s.slice(7),l=P_(o);if(l instanceof $){let u=l[0][0],c=l[0][1];return n(new ss(u,c))}else return}else if(s.startsWith("import:")){let o=s.slice(7);return n(new Xl(o))}else return};return _c(r),Ul(r),fc(n,new Ir,a([new Mr(a([new ir("Escape")]),new cs,a([new rr])),new Mr(a([new Lr,new ir("z")]),new Ur,a([new rr]))]))});return[new X(Hr(),new on,a([]),1,1,a([]),a([]),new se,new se),t]}function Y_(e,t){if(t instanceof ss){let n=t.lat,r=t.lon,i=new X(e.form,e.current_form,e.actions,e.next_node_id,e.next_path_id,e.nodes,e.paths,new Q([n,r]),e.selected_node),s=e.current_form;if(s instanceof Tn){let o=H(e.form,"node_label"),l,u=e.form;l=De(u,a([["lat",Ue(n)],["lon",Ue(r)],["node_label",o]]));let c=l;return[new X(c,i.current_form,i.actions,i.next_node_id,i.next_path_id,i.nodes,i.paths,i.selected_coords,i.selected_node),E()]}else if(s instanceof Wt){let o=H(e.form,"node_label"),l,u=e.form;l=De(u,a([["lat",Ue(n)],["lon",Ue(r)],["node_label",o]]));let c=l;return[new X(c,i.current_form,i.actions,i.next_node_id,i.next_path_id,i.nodes,i.paths,i.selected_coords,i.selected_node),E()]}else return[i,E()]}else if(t instanceof os){let n=t.node_id,r=e.current_form;if(r instanceof rn){let i=H(e.form,"origin_node_id"),s=H(e.form,"destination_node_id"),o=H(e.form,"value"),l;if(i===""){let c=e.form;l=De(c,a([["origin_node_id",n],["destination_node_id",s],["value",o]]))}else if(s===""){lr("flow-map","value");let c=e.form;l=De(c,a([["origin_node_id",i],["destination_node_id",n],["value",o]]))}else l=e.form;let u=l;return[new X(u,e.current_form,e.actions,e.next_node_id,e.next_path_id,e.nodes,e.paths,e.selected_coords,new se),E()]}else if(r instanceof sn){let i=H(e.form,"origin_node_id"),s=H(e.form,"destination_node_id"),o=H(e.form,"value"),l;if(i===""){let c=e.form;l=De(c,a([["origin_node_id",n],["destination_node_id",s],["value",o]]))}else if(s===""){lr("flow-map","value");let c=e.form;l=De(c,a([["origin_node_id",i],["destination_node_id",n],["value",o]]))}else l=e.form;let u=l;return[new X(u,e.current_form,e.actions,e.next_node_id,e.next_path_id,e.nodes,e.paths,e.selected_coords,new se),E()]}else return[new X(e.form,e.current_form,e.actions,e.next_node_id,e.next_path_id,e.nodes,e.paths,e.selected_coords,new Q(n)),mn(i=>i(new Pr(n)))]}else if(t instanceof Pr){let n=t.node_id;if(n===""){let r=e.selected_coords;if(r instanceof Q){let i=r[0][0],s=r[0][1],o=Ec(e,i,s,""),l,u;l=o[0],u=o[1];let c=new X(Sc(u),new Wt(u.node_id),l.actions,l.next_node_id,l.next_path_id,l.nodes,l.paths,l.selected_coords,new Q(u.node_id));return sr(u.node_id,i,s,""),lr("flow-map","node_label"),[c,E()]}else return[new X(zc(),new Tn,e.actions,e.next_node_id,e.next_path_id,e.nodes,e.paths,e.selected_coords,e.selected_node),E()]}else{let r=n,i,o=Kl(e,r);i=Gt(o,new ar("default",0,0,""));let l=i;return l.node_id==="default"?[e,E()]:[new X(Sc(l),new Wt(l.node_id),e.actions,e.next_node_id,e.next_path_id,e.nodes,e.paths,e.selected_coords,new Q(l.node_id)),E()]}}else if(t instanceof ls){let n=t[0];if(n instanceof $){let r=n[0];if(r instanceof ds){let i=r.lat,s=r.lon,o=r.node_label,l=e.current_form;if(l instanceof Tn){let u=Ec(e,i,s,o),c,f;return c=u[0],f=u[1],sr(f.node_id,i,s,o),[_t(c),E()]}else if(l instanceof Wt){let u=l.node_id,c=S_(e,u,i,s,o);if(c instanceof $){let f=c[0];return ts(u,i,s,o),o===""?(lr("flow-map","node_label"),[new X(f.form,f.current_form,f.actions,f.next_node_id,f.next_path_id,f.nodes,f.paths,f.selected_coords,new Q(u)),E()]):[_t(f),E()]}else return[e,E()]}else return[e,E()]}else return[e,E()]}else{let r=n[0];return[new X(r,e.current_form,e.actions,e.next_node_id,e.next_path_id,e.nodes,e.paths,e.selected_coords,e.selected_node),E()]}}else if(t instanceof Fr){let n=t.path_id;if(n===""){let r=e.selected_node;if(r instanceof Q){let i=r[0],s,o=Zl();s=De(o,a([["origin_node_id",i]]));let l=s;return[new X(l,new rn,e.actions,e.next_node_id,e.next_path_id,e.nodes,e.paths,e.selected_coords,e.selected_node),E()]}else return[new X(Zl(),new rn,e.actions,e.next_node_id,e.next_path_id,e.nodes,e.paths,e.selected_coords,e.selected_node),E()]}else{let r=n,i,o=Ql(e,r);i=Gt(o,new ur("default","","",0));let l=i;return l.path_id==="default"?[e,E()]:[new X(q_(l),new sn(l.path_id),e.actions,e.next_node_id,e.next_path_id,e.nodes,e.paths,e.selected_coords,e.selected_node),E()]}}else if(t instanceof as){let n=t[0];if(n instanceof $){let r=n[0];if(r instanceof ps){let i=r.origin_node_id,s=r.destination_node_id,o=r.value,l=e.current_form;if(l instanceof rn){let u=C_(e,i,s,o),c,f;c=u[0],f=u[1];let d=_t(c);return or(f.path_id,i,s,o),[d,E()]}else if(l instanceof sn){let u=l.node_id,c=B_(e,u,i,s,o);if(c instanceof $){let f=c[0],d=_t(f);return Rl(u,i,s,o),[d,E()]}else return[e,E()]}else return[e,E()]}else return[e,E()]}else{let r=n[0];return[new X(r,e.current_form,e.actions,e.next_node_id,e.next_path_id,e.nodes,e.paths,e.selected_coords,e.selected_node),E()]}}else if(t instanceof Rr){let n=t.node_id,r=Kl(e,n);if(r instanceof $){let i=r[0],s=T_(e,n),o=we(e.nodes,c=>c.node_id!==n),l=we(e.paths,c=>c.origin_node_id!==n&&c.destination_node_id!==n),u=new X(Hr(),new on,h(new ms(i,s),e.actions),e.next_node_id,e.next_path_id,o,l,e.selected_coords,e.selected_node);return Fl(i.node_id),Pn(s,c=>ns(c.path_id)),[u,E()]}else return[e,E()]}else if(t instanceof us){let n=t.path_id,r=Ql(e,n);if(r instanceof $){let i=r[0],s=we(e.paths,l=>l.path_id!==n),o=new X(Hr(),new on,h(new Jl(i),e.actions),e.next_node_id,e.next_path_id,e.nodes,s,e.selected_coords,e.selected_node);return ns(i.path_id),[o,E()]}else return[e,E()]}else if(t instanceof Ur){let n=e.actions;if(n instanceof y)return[e,E()];{let r=n.head;if(r instanceof _s){let i=n.tail,s=r.node,o=we(e.nodes,f=>f.node_id!==s.node_id),l,u=new X(e.form,e.current_form,i,e.next_node_id,e.next_path_id,o,e.paths,e.selected_coords,e.selected_node);l=_t(u);let c=l;return Fl(s.node_id),[c,E()]}else if(r instanceof hs){let i=n.tail,s=r.new,o=R(e.nodes,f=>f.node_id===s.node_id?s:f),l,u=new X(e.form,e.current_form,i,e.next_node_id,e.next_path_id,o,e.paths,e.selected_coords,e.selected_node);l=_t(u);let c=l;return ts(s.node_id,s.lat,s.lon,s.node_label),[c,E()]}else if(r instanceof ms){let i=n.tail,s=r.node,o=r.deleted_paths,l,u=new X(e.form,e.current_form,i,e.next_node_id,e.next_path_id,h(s,e.nodes),Oe(o,e.paths),e.selected_coords,e.selected_node);l=_t(u);let c=l;return sr(s.node_id,s.lat,s.lon,s.node_label),Pn(o,f=>or(f.path_id,f.origin_node_id,f.destination_node_id,f.value)),[c,E()]}else if(r instanceof $s){let i=n.tail,s=r.path,o=we(e.paths,f=>f.path_id!==s.path_id),l,u=new X(e.form,e.current_form,i,e.next_node_id,e.next_path_id,e.nodes,o,e.selected_coords,e.selected_node);l=_t(u);let c=l;return ns(s.path_id),[c,E()]}else if(r instanceof xs){let i=n.tail,s=r.new,o=R(e.paths,f=>f.path_id===s.path_id?s:f),l,u=new X(e.form,e.current_form,i,e.next_node_id,e.next_path_id,e.nodes,o,e.selected_coords,e.selected_node);l=_t(u);let c=l;return Rl(s.path_id,s.origin_node_id,s.destination_node_id,s.value),[c,E()]}else{let i=n.tail,s=r.path,o,l=new X(e.form,e.current_form,i,e.next_node_id,e.next_path_id,e.nodes,h(s,e.paths),e.selected_coords,e.selected_node);o=_t(l);let u=o;return or(s.path_id,s.origin_node_id,s.destination_node_id,s.value),[u,E()]}}}else if(t instanceof cs){let n,r=new X(e.form,e.current_form,e.actions,e.next_node_id,e.next_path_id,e.nodes,e.paths,e.selected_coords,new se);n=_t(r);let i=n;return Nt(),[i,E()]}else if(t instanceof fs){let n=U_(e);return hc(n),[e,E()]}else{let n=t.json_data,r=H_(n);if(r instanceof $){let i=r[0],s=mn(o=>mc(i.nodes,i.paths));return[i,s]}else return[e,E()]}}function qc(){let e=Dr(G_,Y_,W_);return qr(e,"flow-map")}var Lc={Consumer:{fill:"#fecaca",stroke:"#dc2626"},Producer:{fill:"#bbf7d0",stroke:"#16a34a"},Scavenger:{fill:"#bfdbfe",stroke:"#2563eb"},Decomposer:{fill:"#fef3c7",stroke:"#d97706"}},Ic={Material:"#16a34a",Financial:"#dc2626",Information:"#2563eb"},M={minWidth:150,minHeight:100,maxWidth:600,maxHeight:300,maxAspectRatio:3,padding:15,nameHeight:25,nameXPadding:25,nameFontSize:"14px",badgeHeight:20,badgeSpacing:7.5,materialSpacing:18,columnGap:20,itemsPerActivityColumn:3,itemsPerMaterialColumn:5,entityMargin:40,flowHoverWidth:8},P={svg:null,g:null,initialised:!1},Gr=null,ce=null,Se=[],it=[];function ws(){return P.initialised||requestAnimationFrame(()=>{let e=document.querySelector("resource-pooling");if(e.closest(".hidden")!==null){ws();return}e.shadowRoot?.getElementById("resource-pooling")?(vh(),P.initialised=!0):ws()}),null}function Nc(e){return Gr=e,null}function Yr(e,t,n=null,r=null){if(!P.g)return;let i=e.entity_id,s=e.value_activities.toArray(),o=e.materials.toArray(),l=t.toArray();if(n==null&&r==null){let d=ch(M.entityMargin);n=d.x,r=d.y}let u=V_(i,n,r),{width:c,height:f}=J_(u,e,s,o,l);return uh(u,i,n,r,c,f),mh(i,e,n,r,c,f),u}function Wc(e,t){if(!P.g)return;let n=e.entity_id,r=P.g.select(`#${n}`);if(r.empty()){console.warn(`Entity with ID ${n} not found`);return}let i=Se.find(l=>l.id===n),s=i?i.x:0,o=i?i.y:0;r.remove(),Yr(e,t,s,o),bh(n)}function Pc(e){if(!P.g)return;P.g.select(`#${e}`).remove();let t=Se.findIndex(n=>n.id===e);t>=0&&(Se.splice(t,1),Yc())}function Fc(e,t){P.g&&P.g.selectAll(".entity").each(function(){d3.select(this).selectAll(".material-item").filter(function(){return d3.select(this).attr("data-material-id")===t}).each(function(){d3.select(this).select("text").text(e)})})}function gs(e){if(!P.g)return;let t=e.flow_id,[n,r]=e.entity_ids,i=e.flow_types.toArray(),s=P.g.select(`#${n}`),o=P.g.select(`#${r}`);if(s.empty()||o.empty()){console.warn(`One or both entities not found: ${n}, ${r}`);return}let l=P.g.select(".flows-group").append("g").attr("class","flow").attr("id",t),u=Dc(s),c=Dc(o);return i.forEach((f,d)=>{fh(l,u,c,f,d)}),dh(l,t),$h(t,n,r,e),l}function Rc(e){P.g&&(bs(e.flow_id),gs(e))}function bs(e){if(!P.g)return;P.g.select(`#${e}`).remove();let t=it.findIndex(n=>n.id===e);t>=0&&(it.splice(t,1),Yc())}function Uc(e){let t=JSON.parse(e),n={nodes:Se.map(u=>({id:u.id,x:u.x||0,y:u.y||0,width:u.width||150,height:u.height||100})),links:it.map(u=>({id:u.id,source:typeof u.source=="object"?u.source.id:u.source,target:typeof u.target=="object"?u.target.id:u.target}))},i=JSON.stringify({gleam_state:t,d3_state:n},null,2),s=new Blob([i],{type:"application/json"}),o=URL.createObjectURL(s),l=document.createElement("a");l.href=o,l.download=`resource-pooling-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o)}function ea(e){requestAnimationFrame(()=>{let n=document.querySelector("resource-pooling").shadowRoot.querySelector("#import-file");if(!n){ea(e);return}n.addEventListener("change",r=>{let i=r.target.files[0];if(i){let s=new FileReader;s.onload=o=>{try{let l=JSON.parse(o.target.result);l.d3_state&&l.gleam_state?(window.pendingD3State=l.d3_state,e(`import:${JSON.stringify(l.gleam_state)}`)):console.error("Invalid file format")}catch(l){console.error("Failed to parse import file:",l)}},s.readAsText(i)}})})}function Hc(e,t,n){if(!window.pendingD3State)return;let r=window.pendingD3State;jh(),e.toArray().forEach(i=>{let s=r.nodes.find(o=>o.id===i.entity_id);s?Yr(i,t,s.x,s.y):Yr(i,t)}),n.toArray().forEach(i=>{gs(i)}),delete window.pendingD3State}function V_(e,t,n){return P.g.select(".entities-group").append("g").attr("class","entity").attr("id",e).attr("transform",`translate(${t}, ${n})`)}function J_(e,t,n,r,i){let s=e.append("rect").attr("class","main-rect"),o=e.append("rect").attr("class","header-rect"),l=K_(e,t.name),u=Q_(l),{activityElements:c,maxActivityWidth:f}=Z_(e,n),{materialElements:d,maxMaterialWidth:_}=nh(e,r,i),m=sh(u,f,_,n.length,r.length);return oh(d,f),lh(s,o,m,t.entity_type),f>0&&_>0&&ah(e,f,m,t.entity_type),m}function K_(e,t){return e.append("text").attr("x",M.nameXPadding).attr("y",M.nameHeight).attr("text-anchor","left").style("font-size",M.nameFontSize).style("font-weight","bold").style("fill","#e5e7eb").text(t)}function Q_(e){return e.node().getBBox().width+M.padding*2+M.nameXPadding}function Z_(e,t){let n=[],r=0;if(t&&t.length>0){let i=Math.ceil(t.length/M.itemsPerActivityColumn),s=[];for(let o=0;o<i;o++){let l=0,u=o*M.itemsPerActivityColumn,c=Math.min(u+M.itemsPerActivityColumn,t.length);for(let f=u;f<c;f++){let d=t[f],_=f-u,m=o>0?s.reduce((x,S)=>x+S+M.columnGap,0):0,w=eh(e,d,m,_),j=th(w,d);l=Math.max(l,j),n.push({badge:w,width:j,column:o})}s.push(l)}r=s.reduce((o,l)=>o+l,0)+(i-1)*M.columnGap}return{activityElements:n,maxActivityWidth:r}}function eh(e,t,n,r){return e.append("g").attr("class","activity-badge").attr("transform",`translate(${M.padding+n}, ${M.nameHeight+M.padding+20+r*(M.badgeHeight+M.badgeSpacing)})`)}function th(e,t){let n=e.append("text").attr("x",0).attr("y",M.badgeHeight/2+4).style("font-size","12px").style("fill","#000000").text(t),i=n.node().getBBox().width+16;return e.insert("rect","text").attr("width",i).attr("height",M.badgeHeight).attr("rx",10).style("fill","#ffffff").style("fill-opacity","0.7").style("stroke","#000000").style("stroke-width",1),n.attr("x",i/2).attr("text-anchor","middle"),i}function nh(e,t,n){let r=[],i=0;if(t&&t.length>0){let s=t.map(u=>n.find(c=>c.material_id===u)).filter(Boolean),o=Math.ceil(s.length/M.itemsPerMaterialColumn),l=[];for(let u=0;u<o;u++){let c=0,f=u*M.itemsPerMaterialColumn,d=Math.min(f+M.itemsPerMaterialColumn,s.length);for(let _=f;_<d;_++){let m=s[_],w=_-f,j=u>0?l.reduce((b,C)=>b+C+M.columnGap,0):0,x=rh(e,m,j,w),S=ih(x);c=Math.max(c,S),r.push({group:x,width:S,column:u})}l.push(c)}i=l.reduce((u,c)=>u+c,0)+(o-1)*M.columnGap}return{materialElements:r,maxMaterialWidth:i}}function rh(e,t,n,r){let i=e.append("g").attr("class","material-item").attr("data-material-id",t.material_id).attr("transform",`translate(${n}, ${M.nameHeight+M.padding+20+r*M.materialSpacing})`);return i.append("circle").attr("cx",0).attr("cy",10).attr("r",2).style("fill","#374151"),i.append("text").attr("x",10).attr("y",12).style("font-size","13px").style("fill","#374151").text(t.name),i}function ih(e){return e.select("text").node().getBBox().width+25}function sh(e,t,n,r,i){let s=Math.max(M.minWidth,e),o=t+n+(t>0&&n>0?M.columnGap:0),l=Math.max(s,o+M.padding*2),u=Math.min(M.itemsPerActivityColumn,r),c=Math.min(M.itemsPerMaterialColumn,i),f=u>0?u*(M.badgeHeight+M.badgeSpacing):0,d=c>0?c*M.materialSpacing:0,_=Math.max(f,d),m=Math.max(M.minHeight,M.nameHeight+M.padding*2+_+20);return{width:l,height:m}}function oh(e,t){e.forEach(({group:n})=>{let i=n.attr("transform").match(/translate\(0, ([\d.]+)\)/)[1];n.attr("transform",`translate(${M.padding+t+M.columnGap}, ${i})`)})}function lh(e,t,n,r){let i=Lc[r];e.attr("width",n.width).attr("height",n.height).style("fill",i.fill).style("stroke",i.stroke).style("stroke-width",1.5).style("cursor","move"),t.attr("width",n.width).attr("height",M.nameHeight+14).style("fill",i.stroke).style("cursor","move")}function ah(e,t,n,r){let i=M.padding+t+M.columnGap/2,s=M.nameHeight+10,o=n.height,l=Lc[r];e.append("line").attr("class","content-divider").attr("x1",i).attr("y1",s).attr("x2",i).attr("y2",o).style("stroke",l.stroke).style("stroke-width",2).style("opacity",.5)}function uh(e,t,n,r,i,s){let o,l;e.call(d3.drag().on("start",function(u){!u.active&&ce&&ce.alphaTarget(.3).restart();let c=Se.find(f=>f.id===t);c&&(o=u.x-c.x,l=u.y-c.y,c.fx=c.x,c.fy=c.y)}).on("drag",function(u){let c=Se.find(f=>f.id===t);c&&(c.fx=u.x-o,c.fy=u.y-l)}).on("end",function(u){!u.active&&ce&&ce.alphaTarget(0);let c=Se.find(f=>f.id===t);c&&(c.fx=null,c.fy=null)})).on("click",function(u){u.stopPropagation(),Gr&&Gr("entity_id:"+t)})}function ch(e=40){if(!P.g)return{x:100,y:100};let t=P.g.selectAll(".entity");if(t.empty())return{x:100,y:100};let n=1/0,r=-1/0,i=1/0,s=-1/0,o=0,l=0,u=0;t.each(function(){let m=d3.select(this).attr("transform").match(/translate\(([^,]+),([^)]+)\)/),w=m?parseFloat(m[1]):0,j=m?parseFloat(m[2]):0,x=d3.select(this).select(".main-rect"),S=parseFloat(x.attr("width"))||150,b=parseFloat(x.attr("height"))||100;n=Math.min(n,w),r=Math.max(r,w+S),i=Math.min(i,j),s=Math.max(s,j+b),o+=w,l+=j,u++});let c=r-n,f=s-i;return c/f>1.5?{x:o/u,y:s+e}:{x:r+e,y:l/u}}function Dc(e){let n=e.attr("transform").match(/translate\(([^,]+),([^)]+)\)/),r=n?parseFloat(n[1]):0,i=n?parseFloat(n[2]):0,s=e.select(".main-rect"),o=parseFloat(s.attr("width"))||150,l=parseFloat(s.attr("height"))||100;return{x:r,y:i,width:o,height:l,centerX:r+o/2,centerY:i+l/2,right:r+o,bottom:i+l}}function fh(e,t,n,r,i){let s={x:t.centerX,y:t.centerY},o={x:n.centerX,y:n.centerY},l=ys(t,o.x,o.y,r,i),u=ys(n,s.x,s.y,r,i),c=Gc(l,u),f=Ic[r.flow_category]||"#666",d=e.append("path").attr("class","flow-hover").attr("d",c).style("fill","none").style("stroke","transparent").style("stroke-width",M.flowHoverWidth).style("cursor","pointer"),_=e.append("path").attr("class","flow-path").attr("d",c).style("fill","none").style("stroke",f).style("stroke-width",1).style("stroke-dasharray",r.is_future?"5,5":"none").style("pointer-events","none");return ph(_,r),_.datum({flowType:r,index:i}),d.datum({flowType:r,index:i}),{hoverPath:d,flowPath:_}}function dh(e,t){e.on("click",function(n){n.stopPropagation(),Gr&&Gr("flow_id:"+t)})}function ph(e,t){let n=_h(),r=Ic[t.flow_category]||"#666",i=t.flow_category.toLowerCase();Mc(n,`arrow-${i}`,r,!1),Mc(n,`arrow-reverse-${i}`,r,!0),t.direction===1?e.attr("marker-end",`url(#arrow-${i})`):t.direction===-1?e.attr("marker-start",`url(#arrow-reverse-${i})`):t.direction===0&&e.attr("marker-start",`url(#arrow-reverse-${i})`).attr("marker-end",`url(#arrow-${i})`)}function _h(){let e=P.svg.select("defs");return e.empty()&&(e=P.svg.append("defs")),e}function Mc(e,t,n,r){if(!e.select(`#${t}`).empty())return;let i=e.append("marker").attr("id",t).attr("viewBox","0 -5 10 10").attr("refX",r?2:8).attr("refY",0).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto"),s=r?"M10,-5L0,0L10,5":"M0,-5L10,0L0,5";i.append("path").attr("d",s).attr("fill",n)}function ys(e,t,n,r=null,i=0){let s=e.x+e.width/2,o=e.y+e.height/2,l=t-s,u=n-o,c=e.width/2,f=e.height/2,d=Math.abs(u/l),_=f/c,m,w;if(d<=_?(m=l>0?s+c:s-c,w=o+u/l*c*Math.sign(l)):(w=u>0?o+f:o-f,m=s+l/u*f*Math.sign(u)),r){let j=hh(r);d<=_?(w+=j,w=Math.max(e.y+5,Math.min(e.y+e.height-5,w))):(m+=j,m=Math.max(e.x+5,Math.min(e.x+e.width-5,m)))}return{x:m,y:w}}function hh(e){return{Material:-12,Financial:0,Information:12}[e.flow_category]||0}function Gc(e,t){let n=t.x-e.x,r=t.y-e.y,i=(e.x+t.x)/2,s=(e.y+t.y)/2,o=Math.sqrt(n*n+r*r),l=Math.min(o*.1,20),u=i+(Math.abs(r)>Math.abs(n)?l:0),c=s+(Math.abs(n)>Math.abs(r)?l:0);return`M${e.x},${e.y} Q${u},${c} ${t.x},${t.y}`}function mh(e,t,n,r,i,s){let o={id:e,x:n,y:r,width:i,height:s,entity:t},l=Se.findIndex(u=>u.id===e);l>=0?Se[l]=o:Se.push(o),ce&&(ce.nodes(Se),ce.alpha(.3).restart())}function $h(e,t,n,r){let i={id:e,source:t,target:n,flow:r},s=it.findIndex(o=>o.id===e);s>=0?it[s]=i:it.push(i),ce&&(ce.force("link").links(it),ce.alpha(.3).restart())}function Yc(){ce&&(ce.nodes(Se),ce.force("link").links(it),ce.alpha(.3).restart())}function xh(){return ce=d3.forceSimulation().force("charge",d3.forceManyBody().strength(-50)).force("link",d3.forceLink().id(e=>e.id).distance(100).strength(.1)).force("collision",d3.forceCollide().radius(e=>Math.sqrt(e.width*e.width+e.height*e.height)/2+10)).on("tick",wh),ce}function wh(){P.g&&(P.g.selectAll(".entity").each(function(){let e=d3.select(this),t=e.attr("id"),n=Se.find(r=>r.id===t);n&&e.attr("transform",`translate(${n.x}, ${n.y})`)}),yh())}function yh(){P.g&&P.g.selectAll(".flow").each(function(){let e=d3.select(this),t=e.attr("id"),n=it.find(r=>r.id===t);if(n&&n.source&&n.target){let r=typeof n.source=="object"?n.source:Se.find(s=>s.id===n.source),i=typeof n.target=="object"?n.target:Se.find(s=>s.id===n.target);r&&i&&gh(e,r,i)}})}function gh(e,t,n){let r={x:t.x,y:t.y,width:t.width||150,height:t.height||100,centerX:t.x+(t.width||150)/2,centerY:t.y+(t.height||100)/2},i={x:n.x,y:n.y,width:n.width||150,height:n.height||100,centerX:n.x+(n.width||150)/2,centerY:n.y+(n.height||100)/2};e.selectAll(".flow-path, .flow-hover").each(function(s,o){let l=d3.select(this),c=l.datum()?.flowType||null,f=ys(r,i.centerX,i.centerY,c,o),d=ys(i,r.centerX,r.centerY,c,o),_=Gc(f,d);l.attr("d",_)})}function bh(e){let t=Se.find(n=>n.id===e);t&&(it.forEach(n=>{(typeof n.source=="object"&&n.source.id===e||n.source===e)&&(n.source=t),(typeof n.target=="object"&&n.target.id===e||n.target===e)&&(n.target=t)}),ce&&(ce.force("link").links(it),ce.nodes(Se),ce.alpha(.3).restart()))}function vh(){let e=document.querySelector("resource-pooling").shadowRoot,t=e.getElementById("resource-pooling"),n=t.clientWidth,r=window.innerHeight*.6;P.svg=d3.select(e.getElementById("resource-pooling")).append("svg").attr("width","100%").style("width",n).attr("height",r).style("cursor","crosshair"),P.g=P.svg.append("g"),P.g.append("g").attr("class","flows-group"),P.g.append("g").attr("class","entities-group"),kh(),P.svg.append("defs"),xh(),window.addEventListener("resize",()=>{let i=t.clientWidth,s=window.innerHeight*.6;P.svg.style("width",i).attr("height",s)})}function kh(){let e=d3.zoom().scaleExtent([.1,200]).on("zoom",t=>{P.g.attr("transform",t.transform)}).on("end",t=>{P.g.attr("transform",`${t.transform} translate(0, 0)`),requestAnimationFrame(()=>{P.g.attr("transform",t.transform)})});P.svg.call(e)}function jh(){P.g&&(P.g.selectAll(".entity").remove(),P.g.selectAll(".flow").remove(),Se=[],it=[],ce&&(ce.nodes([]),ce.force("link").links([])))}var K=class extends p{constructor(t,n,r,i,s,o,l,u,c,f){super(),this.materials=t,this.entities=n,this.flows=r,this.form=i,this.current_form=s,this.next_material_id=o,this.next_entity_id=l,this.next_flow_id=u,this.selected_material_ids=c,this.value_activities=f}},Xr=class extends p{constructor(t){super(),this.entity_id=t}},js=class extends p{},Vr=class extends p{constructor(t){super(),this.flow_id=t}},Es=class extends p{constructor(t){super(),this[0]=t}},Ss=class extends p{constructor(t){super(),this.material_id=t}},As=class extends p{constructor(t){super(),this[0]=t}},Cs=class extends p{constructor(t,n){super(),this.name=t,this.material_id=n}},Ts=class extends p{constructor(t){super(),this[0]=t}},Bs=class extends p{constructor(t){super(),this.material_id=t}},zs=class extends p{constructor(t){super(),this.material_id=t}},Os=class extends p{constructor(t){super(),this[0]=t}},qs=class extends p{constructor(t,n){super(),this.activity=t,this.activity_id=n}},Ds=class extends p{constructor(t){super(),this.activity=t}},Jr=class extends p{constructor(t){super(),this.entity_id=t}},Ms=class extends p{constructor(t){super(),this.flow_type=t}},Ls=class extends p{constructor(t){super(),this.flow_type=t}},Is=class extends p{constructor(t){super(),this.flow_id=t}},Ns=class extends p{},na=class extends p{constructor(t){super(),this.json_data=t}},cr=class extends p{constructor(t,n,r,i,s){super(),this.name=t,this.entity_id=n,this.value_activities=r,this.materials=i,this.entity_type=s}},fr=class extends p{constructor(t,n){super(),this.name=t,this.material_id=n}},Pt=class extends p{constructor(t,n,r){super(),this.flow_id=t,this.entity_ids=n,this.flow_types=r}},Kr=class extends p{constructor(t,n,r){super(),this.flow_category=t,this.direction=n,this.is_future=r}},dr=class extends p{},Bn=class extends p{constructor(t){super(),this.entity_id=t}},Ws=class extends p{},pr=class extends p{},Ft=class extends p{constructor(t){super(),this.flow_id=t}},zn=class extends p{},Ps=class extends p{constructor(t){super(),this.name=t}},Fs=class extends p{constructor(t,n){super(),this.name=t,this.entity_type=n}},Rs=class extends p{constructor(t,n,r,i,s,o,l,u,c,f,d){super(),this.entity_id_1=t,this.entity_id_2=n,this.material_flow=r,this.material_direction=i,this.material_future=s,this.financial_flow=o,this.financial_direction=l,this.financial_future=u,this.information_flow=c,this.information_direction=f,this.information_future=d}},ra=class extends p{};function Eh(e){let t=Aa(e);return ho(t)}function Kc(){return Ee("resource-pooling",a([]),a([]))}function Qc(){return a(["Consumer","Producer","Scavenger","Decomposer"])}function ia(e,t){return ke(e.entities,n=>n.entity_id===t)}function Sh(e,t,n,r){return at(ia(e,t),i=>{let s=new cr(n,i.entity_id,e.value_activities,e.selected_material_ids,r),o=R(e.entities,u=>u.entity_id===t?s:u),l=new K(e.materials,o,e.flows,e.form,e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,e.value_activities);return new $([s,l])})}function Ah(){return L("name",ee,e=>L("entity_id",ee,t=>L("value_activities",Me(ee),n=>L("materials",Me(ee),r=>L("entity_type",ee,i=>ge(new cr(e,t,n,r,i)))))))}function Ch(e,t){return fn(t,n=>ke(e.materials,r=>r.material_id===n))}function Th(){return L("name",ee,e=>L("material_id",ee,t=>ge(new fr(e,t))))}function sa(e,t){return ke(e.flows,n=>n.flow_id===t)}function Bh(e,t,n,r,i,s,o,l,u,c,f,d,_){return at(sa(e,t),m=>{let w=new Pt(m.flow_id,[n,r],(()=>{let S=we(a([[i,s,o,"Material"],[l,u,c,"Financial"],[f,d,_,"Information"]]),b=>b[0]==="on");return R(S,b=>new Kr(b[3],b[1],b[2]))})()),j=R(e.flows,S=>S.flow_id===t?w:S),x=new K(e.materials,e.entities,j,e.form,e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,e.value_activities);return new $([w,x])})}function zh(){return L("flow_category",ee,e=>L("direction",xt,t=>L("is_future",pn,n=>ge(new Kr(e,t,n)))))}function Oh(){return L("flow_id",ee,e=>L("entity_ids",Me(ee),t=>L("flow_types",Me(zh()),n=>{if(t instanceof y)return kr(new Pt("",["",""],a([])),"entity_ids must be an array of exactly 2 strings");{let r=t.tail;if(r instanceof y)return kr(new Pt("",["",""],a([])),"entity_ids must be an array of exactly 2 strings");if(r.tail instanceof y){let s=t.head,o=r.head;return ge(new Pt(e,[s,o],n))}else return kr(new Pt("",["",""],a([])),"entity_ids must be an array of exactly 2 strings")}})))}function qh(){return Lt(de("new-material",Mt(Ye),e=>Dt(new Ps(e))))}function Zc(){let e=t=>St(h("",Qc()),t)?new $(t):new A("invalid entity type");return Lt(de("name",Mt(Ye),t=>de("entity-type",(()=>{let r=Mt(Ye);return vt(r,e)})(),n=>Dt(new Fs(t,n)))))}function ks(e){let t=n=>n===-1?new $(n):n===0?new $(n):n===1?new $(n):new A("invalid direction");return Lt(de("entity-id-1",Mt(Ye),n=>{let r=s=>s===n?new A("entities must be separate"):new $(s),i=s=>{let o=e.current_form,l=(()=>{let u=we(e.flows,c=>Z(c.entity_ids,[n,s])||Z(c.entity_ids,[s,n]));return so(u)})();return o instanceof Ft?new $(s):l===0?new $(s):new A("entity combination exists")};return de("entity-id-2",(()=>{let o=Mt(Ye),l=vt(o,r);return vt(l,i)})(),s=>de("material-direction",vt(Ki,t),o=>de("material-future",Ji,l=>de("financial-flow",Ye,u=>de("financial-direction",vt(Ki,t),c=>de("financial-future",Ji,f=>de("information-flow",Ye,d=>de("information-direction",vt(Ki,t),_=>de("information-future",Ji,m=>{let w=j=>St(a([j,u,d]),"on")?new $(j):new A("select at least one flow");return de("material-flow",vt(Ye,w),j=>Dt(new Rs(n,s,j,o,l,u,c,f,d,_,m)))})))))))))}))}function Dh(e){let t=Zc();return De(t,a([["name",e.name],["entity-type",e.entity_type]]))}function Mh(e,t){let n=new K(t.materials,t.entities,t.flows,t.form,new Ft(e.flow_id),t.next_material_id,t.next_entity_id,t.next_flow_id,t.selected_material_ids,t.value_activities),r;ke(e.flow_types,z=>z.flow_category==="Material")instanceof $?r="on":r="";let s=r,o;ke(e.flow_types,z=>z.flow_category==="Financial")instanceof $?o="on":o="";let u=o,c;ke(e.flow_types,z=>z.flow_category==="Information")instanceof $?c="on":c="";let d=c,_,m=ke(e.flow_types,z=>z.flow_category==="Material");if(m instanceof $){let z=m[0];_=re(z.direction)}else _="1";let w=_,j,x=ke(e.flow_types,z=>z.flow_category==="Material");x instanceof $&&x[0].is_future?j="on":j="";let S=j,b,C=ke(e.flow_types,z=>z.flow_category==="Financial");if(C instanceof $){let z=C[0];b=re(z.direction)}else b="1";let D=b,g,T=ke(e.flow_types,z=>z.flow_category==="Financial");T instanceof $&&T[0].is_future?g="on":g="";let B=g,I,U=ke(e.flow_types,z=>z.flow_category==="Information");if(U instanceof $){let z=U[0];I=re(z.direction)}else I="1";let V=I,oe,Ae=ke(e.flow_types,z=>z.flow_category==="Information");Ae instanceof $&&Ae[0].is_future?oe="on":oe="";let st=oe,ue=a([["entity-id-1",e.entity_ids[0]],["entity-id-2",e.entity_ids[1]],["material-direction",w],["financial-direction",D],["information-direction",V]]),le=we(a([["material-flow",s],["financial-flow",u],["information-flow",d],["material-future",S],["financial-future",B],["information-future",st]]),z=>z[1]==="on"),N=ks(n);return De(N,Oe(ue,le))}function Lh(e,t,n){let r=nn(e,t);return O(a([]),h(O(a([k("py-2")]),a([Pe(a([gt(t)]),a([F(n+": ")]))])),h(pt(a([k("w-full bg-gray-200 text-gray-700 rounded-sm px-2 py-1"),qe(t),Ne("text"),Ie(t),fe(H(e,t))])),R(r,i=>Kt(a([k("mt-0.5 text-xs text-red-300")]),a([Jt(i)]))))))}function Xc(e,t,n,r){let i=nn(e,t);return O(a([]),h(O(a([k("py-2")]),a([Pe(a([gt(t)]),a([F(n+": ")]))])),h(yn(a([k("w-full bg-gray-200 text-gray-700 rounded-sm px-2 py-1"),qe(t),Ie(t)]),h(Ge(a([fe(""),ct(H(e,t)==="")]),"Select an entity..."),R(r,s=>{let o=H(e,t)===s.entity_id;return Ge(a([fe(s.entity_id),ct(o)]),(()=>{let l=s.name,u=s.entity_id;return u.startsWith("entity-id-")&&l===""?"Entity "+u.slice(10):s.name})())}))),R(i,s=>Kt(a([k("mt-0.5 text-xs text-red-300")]),a([Jt(s)]))))))}function ef(e,t){return O(a([k("flex py-2")]),a([pt(a([k("w-5/6 bg-gray-200 text-gray-700 rounded-sm px-2 py-1"),qe(t),Ne("text"),Ie(e),fe("")])),Te(a([k("w-1/8 bg-green-600 hover:bg-green-400 rounded-sm p-1 ml-2 flex items-center justify-center")]),a([jn(a([W("stroke-width","1.5"),W("stroke","currentColor"),k("size-6")]),a([En(a([W("stroke-linecap","round"),W("stroke-linejoin","round"),W("d","M12 4.5v15m7.5-7.5h-15")]))]))]))]))}function Ih(e){let t=n=>new Cs(n,e.material_id);return O(a([k("flex py-2")]),a([pt(a([k("w-5/6 bg-gray-200 text-gray-700 rounded-sm px-2 py-1"),qe(e.material_id),Ne("text"),Ie(e.material_id),fe(e.name),Ri(t)])),Te(a([k("w-1/8 bg-red-600 hover:bg-red-400 rounded-sm p-1 ml-2 flex items-center justify-center"),Ne("button"),he(new Ss(e.material_id))]),a([jn(a([W("stroke-width","1.5"),W("stroke","currentColor"),k("size-6")]),a([En(a([W("stroke-linecap","round"),W("stroke-linejoin","round"),W("d","M6 18 18 6M6 6l12 12")]))]))]))]))}function Nh(e,t){let n=r=>{let s=Cn(e,r),o=An(s);return new As(o)};return O(a([k("flex-1 py-2")]),a([Qt(a([tn(n)]),h(ef("new-material","material-id-"+re(t.next_material_id)),(()=>{let r=t.materials,i=R(r,s=>Ih(s));return G(i)})()))]))}function Wh(e,t){let n=r=>new qs(r,t);return O(a([k("flex py-2")]),a([pt(a([k("w-5/6 bg-gray-200 text-gray-700 rounded-sm px-2 py-1"),qe("activity-id-"+re(t)),Ne("text"),Ie("activity-"+e),fe(e),Ri(n)])),Te(a([k("w-1/8 bg-red-600 hover:bg-red-400 rounded-sm p-1 ml-2 flex items-center justify-center"),Ne("button"),he(new Ds(e))]),a([jn(a([W("stroke-width","1.5"),W("stroke","currentColor"),k("size-6")]),a([En(a([W("stroke-linecap","round"),W("stroke-linejoin","round"),W("d","M6 18 18 6M6 6l12 12")]))]))]))]))}function Ph(e){let t=nn(e,"entity-type"),n=H(e,"entity-type");return O(a([k("py-2")]),h(Pe(a([]),a([F("Select Type:")])),h(yn(a([k("w-full bg-gray-200 text-gray-700 rounded-sm px-2 py-1 mt-2"),Ie("entity-type"),fe(H(e,"entity-type"))]),h(Ge(n===""?a([fe(""),ct(!0)]):a([fe("")]),"Select entity type..."),R(Qc(),r=>Ge(n===r?a([fe(r),ct(!0)]):a([fe(r)]),r)))),R(t,r=>Kt(a([k("mt-0.5 text-xs text-red-300")]),a([Jt(r)]))))))}function ta(e,t){let n=nn(e,t+"-flow"),r="flex-1 px-2 py-1 mt-1 bg-gray-600 rounded-sm "+(H(e,t+"-flow")===""?"hidden":"");return O(a([k("py-2")]),a([Pe(a([k("mr-2")]),a([F(Sa(t)+" Flow")])),pt(a([Ne("checkbox"),Ie(t+"-flow"),Co(H(e,t+"-flow")==="on"),he(new Ms(t))])),O(a([k("w-full")]),R(n,i=>Kt(a([k("mt-0.5 text-xs text-red-300")]),a([Jt(i)])))),O(a([k(r)]),a([O(a([k("w-full text-sm")]),a([Pe(a([gt(t+"-direction")]),a([F("Direction: ")])),yn(a([k("ml-2 w-1/2 bg-gray-200 text-gray-700 rounded-sm px-2 mt-2"),Ie(t+"-direction")]),a([Ge(a([fe("1"),ct(H(e,t+"-direction")==="1")]),"1 \u2192 2"),Ge(a([fe("-1"),ct(H(e,t+"-direction")==="-1")]),"2 \u2192 1"),Ge(a([fe("0"),ct(H(e,t+"-direction")==="0")]),"Bidirectional")]))])),O(a([k("w-full mt-2 text-sm")]),a([Pe(a([gt(t+"-future")]),a([F("Future State? ")])),pt(a([Ne("checkbox"),Ie(t+"-future"),k("ml-2"),Co(H(e,t+"-future")==="on"),he(new Ls(t))]))]))]))]))}function Fh(e,t,n){let r=Ch(e,n);return O(a([k("py-2")]),a([Pe(a([]),a([F("Select Materials:")])),O(a([]),R(r,i=>Au(a([k("inline-flex items-center rounded-md bg-green-400/10 px-2 py-1 text-xs font-medium text-green-400 ring-1 ring-inset ring-green-500/20 cursor-pointer mr-2"),he(new zs(i.material_id))]),a([F(i.name),jn(a([W("viewBox","0 0 24 24"),W("fill","none"),W("stroke","currentColor"),W("stroke-width","1.5"),k("ml-1 size-4")]),a([En(a([W("stroke-linecap","round"),W("stroke-linejoin","round"),W("d","M6 18 18 6M6 6l12 12")]))]))])))),yn(a([k("w-full bg-gray-200 text-gray-700 rounded-sm px-2 py-1 mt-2"),Ri(i=>new Bs(i)),Ie("select-material"),fe("")]),h(Ge(a([fe("")]),"Select a material..."),(()=>{let i=R(t,s=>Ge(a([fe(s.material_id)]),s.name));return G(i)})()))]))}function tf(e,t){let n;e instanceof dr?n="Add Entity":e instanceof Bn?n="Edit Entity":e instanceof pr?n="Add Flow":e instanceof Ft?n="Edit Flow":n="";let r=n;return O(a([k("py-2")]),a([Te(a([k("w-full bg-pink-600 hover:bg-pink-400 px-3 py-2 rounded-sm cursor-pointer"),cu(t)]),a([F(r)]))]))}function nf(e){let t;if(e instanceof Bn){let s=e.entity_id;t=[new Jr(s),"Delete Entity"]}else if(e instanceof Ft){let s=e.flow_id;t=[new Is(s),"Delete Flow"]}else t=[new Jr(""),""];let n=t,r,i;return r=n[0],i=n[1],i===""?zt():Te(a([k("w-full bg-red-600 hover:bg-red-800 px-3 py-2 rounded-sm cursor-pointer"),he(r)]),a([F(i)]))}function Vc(e,t){let n=r=>{let s=Cn(e,r),o=An(s);return new Ts(o)};return O(a([k("flex-1 py-2")]),a([Qt(a([tn(n),qe("main-entity-form")]),a([Lh(e,"name","Name"),Ph(e),Fh(t,t.materials,t.selected_material_ids)])),Qt(a([tn(r=>new Os(r))]),h(Pe(a([]),a([F("Value Activities:")])),h(ef("new-value-activity","new-value-activity"),(()=>{let r=ga(t.value_activities,0,(i,s)=>[i+1,Wh(s,i)])[1];return G(r)})()))),tf(t.current_form,"main-entity-form"),nf(t.current_form)]))}function Jc(e,t){let n=r=>{let s=Cn(e,r),o=An(s);return new Es(o)};return O(a([k("flex-1 py-2")]),a([Qt(a([qe("flow-form"),tn(n)]),a([Xc(e,"entity-id-1","Entity 1",t.entities),Xc(e,"entity-id-2","Entity 2",t.entities),ta(e,"material"),ta(e,"financial"),ta(e,"information"),tf(t.current_form,"flow-form"),nf(t.current_form)]))]))}function Rh(e){let t=e.current_form;return t instanceof dr||t instanceof Bn?Vc(e.form,e):t instanceof Ws?Nh(e.form,e):t instanceof pr||t instanceof Ft?Jc(e.form,e):zt()}function Uh(){return O(a([k("flex-1 mb-2")]),a([Te(a([k("bg-gray-600 hover:bg-gray-400 px-3 py-2 rounded-sm cursor-pointer"),he(new Ns)]),a([F("Download")])),Pe(a([k("bg-gray-600 hover:bg-gray-400 px-3 py-2 rounded-sm cursor-pointer ml-2 inline-block"),gt("import-file")]),a([F("Import"),pt(a([qe("import-file"),Ne("file"),ji(a([".json"])),k("hidden")]))]))]))}function Hh(e){return O(a([k("flex-1 bg-gray-700 text-gray-200 p-4 rounded-lg transition-all duration-300 ease-in-out")]),a([Uh(),Te(a([k("bg-blue-600 hover:bg-blue-400 px-3 py-2 rounded-sm cursor-pointer"),he(new Xr(""))]),a([F("Entity")])),Te(a([k("bg-green-600 hover:bg-green-400 px-3 py-2 rounded-sm cursor-pointer ml-2"),he(new js)]),a([F("Materials")])),Te(a([k("bg-amber-600 hover:bg-amber-400 px-3 py-2 rounded-sm cursor-pointer ml-2"),he(new Vr(""))]),a([F("Flow")])),Rh(e)]))}function Gh(e){return O(a([k("flex flex-1")]),a([O(a([k("flex-col w-2/3 p-4")]),a([O(a([k("flex-1 border-2 border-solid border-gray-900 rounded-lg p-1"),qe("resource-pooling")]),a([]))])),O(a([k("flex-col w-1/3 p-4")]),a([Hh(e)]))]))}function Qr(){let e=Dt(new ra);return Lt(e)}function Yh(){return L("materials",Me(Th()),e=>L("entities",Me(Ah()),t=>L("flows",Me(Oh()),n=>L("next_material_id",xt,r=>L("next_entity_id",xt,i=>L("next_flow_id",xt,s=>ge(new K(e,t,n,Qr(),new zn,r,i,s,a([]),a([])))))))))}function vs(e){return new K(e.materials,e.entities,e.flows,Qr(),new zn,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,e.value_activities)}function Xh(e){return et(a([["name",_e(e.name)],["material_id",_e(e.material_id)]]))}function Vh(e){return et(a([["name",_e(e.name)],["entity_id",_e(e.entity_id)],["value_activities",He(e.value_activities,_e)],["materials",He(e.materials,_e)],["entity_type",_e(e.entity_type)]]))}function Jh(e){return et(a([["flow_category",_e(e.flow_category)],["direction",wt(e.direction)],["is_future",Er(e.is_future)]]))}function Kh(e){return et(a([["flow_id",_e(e.flow_id)],["entity_ids",He(a([e.entity_ids[0],e.entity_ids[1]]),_e)],["flow_types",He(e.flow_types,Jh)]]))}function Qh(e){let t=et(a([["materials",He(e.materials,Xh)],["entities",He(e.entities,Vh)],["flows",He(e.flows,Kh)],["next_material_id",wt(e.next_material_id)],["next_entity_id",wt(e.next_entity_id)],["next_flow_id",wt(e.next_flow_id)]]));return xi(t)}function Zh(e){return $i(e,Yh())}function em(e){let t=mn(n=>{ws();let r=i=>{if(i.startsWith("entity_id:")){let s=i.slice(10);return n(new Xr(s))}else if(i.startsWith("import:")){let s=i.slice(7);return n(new na(s))}else if(i.startsWith("flow_id:")){let s=i.slice(8);return n(new Vr(s))}else return};return Nc(r),ea(r)});return[new K(a([new fr("Energy","material-id-0")]),a([]),a([]),Qr(),new zn,1,1,1,a([]),a([])),t]}function tm(e,t){if(Eh(t),t instanceof Xr){let n=t.entity_id;if(n==="")return[new K(e.materials,e.entities,e.flows,Zc(),new dr,e.next_material_id,e.next_entity_id,e.next_flow_id,a([]),a([])),E()];{let r=n,i,o=ia(e,r);i=Gt(o,new cr("default","",a([]),a([]),""));let l=i;return l.entity_id==="default"?[e,E()]:[new K(e.materials,e.entities,e.flows,Dh(l),new Bn(l.entity_id),e.next_material_id,e.next_entity_id,e.next_flow_id,l.materials,l.value_activities),E()]}}else{if(t instanceof js)return[new K(e.materials,e.entities,e.flows,qh(),new Ws,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,e.value_activities),E()];if(t instanceof Vr){let n=t.flow_id;if(n==="")return[new K(e.materials,e.entities,e.flows,ks(e),new pr,e.next_material_id,e.next_entity_id,e.next_flow_id,a([]),a([])),E()];{let r=n,i,o=sa(e,r);i=Gt(o,new Pt("default",["",""],a([])));let l=i;return l.flow_id==="default"?[e,E()]:[new K(e.materials,e.entities,e.flows,Mh(l,e),new Ft(l.flow_id),e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,e.value_activities),E()]}}else if(t instanceof Es){let n=t[0];if(n instanceof $){let r=n[0];if(r instanceof Rs){let i=r.entity_id_1,s=r.entity_id_2,o=r.material_flow,l=r.material_direction,u=r.material_future,c=r.financial_flow,f=r.financial_direction,d=r.financial_future,_=r.information_flow,m=r.information_direction,w=r.information_future,j=e.current_form;if(j instanceof pr){let x=new Pt("flow-id-"+re(e.next_flow_id),[i,s],(()=>{let S=we(a([[o,l,u,"Material"],[c,f,d,"Financial"],[_,m,w,"Information"]]),b=>b[0]==="on");return R(S,b=>new Kr(b[3],b[1],b[2]))})());return gs(x),[new K(e.materials,e.entities,h(x,e.flows),Qr(),new zn,e.next_material_id,e.next_entity_id,e.next_flow_id+1,a([]),a([])),E()]}else if(j instanceof Ft){let x=j.flow_id,S=Bh(e,x,i,s,o,l,u,c,f,d,_,m,w);if(S instanceof $){let b=S[0][0],C=S[0][1];return Rc(b),[vs(C),E()]}else return[e,E()]}else return[e,E()]}else return[e,E()]}else{let r=n[0];return[new K(e.materials,e.entities,e.flows,r,e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,e.value_activities),E()]}}else if(t instanceof Ss){let n=t.material_id,r=we(e.materials,i=>i.material_id!==n);return[new K(r,e.entities,e.flows,e.form,e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,e.value_activities),E()]}else if(t instanceof As){let n=t[0];if(n instanceof $){let r=n[0];if(r instanceof Ps){let i=r.name;return[new K((()=>{let s=h(new fr(i,"material-id-"+re(e.next_material_id)),e.materials);return gr(s)})(),e.entities,e.flows,e.form,e.current_form,e.next_material_id+1,e.next_entity_id,e.next_flow_id,a([]),a([])),E()]}else return[e,E()]}else{let r=n[0];return[new K(e.materials,e.entities,e.flows,r,e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,e.value_activities),E()]}}else if(t instanceof Cs){let n=t.name,r=t.material_id,i=R(e.materials,s=>s.material_id===r?new fr(n,s.material_id):s);return Fc(n,r),[new K(i,e.entities,e.flows,e.form,e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,e.value_activities),E()]}else if(t instanceof Ts){let n=t[0];if(n instanceof $){let r=n[0];if(r instanceof Fs){let i=r.name,s=r.entity_type,o=e.current_form;if(o instanceof dr){let l=new cr(i,"entity-id-"+re(e.next_entity_id),e.value_activities,e.selected_material_ids,s);return Yr(l,e.materials),[new K(e.materials,h(l,e.entities),e.flows,Qr(),new zn,e.next_material_id,e.next_entity_id+1,e.next_flow_id,a([]),a([])),E()]}else if(o instanceof Bn){let l=o.entity_id,u=Sh(e,l,i,s);if(u instanceof $){let c=u[0][0],f=u[0][1];return Wc(c,e.materials),[vs(f),E()]}else return[e,E()]}else return[e,E()]}else return[e,E()]}else{let r=n[0];return[new K(e.materials,e.entities,e.flows,r,e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,e.value_activities),E()]}}else if(t instanceof Bs){let n=t.material_id,r,i=h(n,e.selected_material_ids),s=si(i,Ea);r=gr(s);let o=r;return[new K(e.materials,e.entities,e.flows,e.form,e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,o,e.value_activities),E()]}else if(t instanceof zs){let n=t.material_id,r=we(e.selected_material_ids,i=>i!==n);return[new K(e.materials,e.entities,e.flows,e.form,e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,r,e.value_activities),E()]}else if(t instanceof Os){let n=t[0];if(n instanceof y)return[e,E()];{let r=n.head[1];if(r==="")return[e,E()];{let i=r;return[new K(e.materials,e.entities,e.flows,e.form,e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,gr(h(i,e.value_activities))),E()]}}}else if(t instanceof qs){let n=t.activity,r=t.activity_id;return[new K(e.materials,e.entities,e.flows,e.form,e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,(()=>{let i=e.value_activities;return ba(i,(s,o)=>o===r?n:s)})()),E()]}else if(t instanceof Ds){let n=t.activity;return[new K(e.materials,e.entities,e.flows,e.form,e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,we(e.value_activities,r=>r!==n)),E()]}else if(t instanceof Jr){let n=t.entity_id,r=ia(e,n);if(r instanceof $){let i=r[0],s=we(e.entities,d=>d.entity_id!==n),o=we(e.flows,d=>d.entity_ids[0]===n||d.entity_ids[1]===n),l=we(e.flows,d=>d.entity_ids[0]!==n&&d.entity_ids[1]!==n),u,c=new K(e.materials,s,l,e.form,e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,e.value_activities);u=vs(c);let f=u;return Pc(i.entity_id),Pn(o,d=>bs(d.flow_id)),[f,E()]}else return[e,E()]}else if(t instanceof Ms){let n=t.flow_type,r=a(["material","financial","information"]),i=n+"-flow",s=H(e.form,i)==="on",o=ks(e),l=a([["entity-id-1",H(e.form,"entity-id-1")],["entity-id-2",H(e.form,"entity-id-2")]]),u=yr(r,f=>{let d=f+"-flow",_=f+"-direction",m=f+"-future",w=H(e.form,m),j;f===n?s?j=a([]):j=a([[d,"on"]]):H(e.form,d)==="on"?j=a([[d,"on"]]):j=a([]);let S=j,b=a([[_,H(e.form,_)]]),C;return w==="on"?C=a([[m,"on"]]):C=a([]),Wn(a([S,b,C]))}),c=Oe(l,u);return[new K(e.materials,e.entities,e.flows,De(o,c),e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,e.value_activities),E()]}else if(t instanceof Ls){let n=t.flow_type,r=a(["material","financial","information"]),i=n+"-future",s=H(e.form,i)==="on",o=ks(e),l=a([["entity-id-1",H(e.form,"entity-id-1")],["entity-id-2",H(e.form,"entity-id-2")]]),u=yr(r,f=>{let d=f+"-flow",_=f+"-direction",m=f+"-future",w=H(e.form,m),j=a([[d,H(e.form,d)],[_,H(e.form,_)]]),x;return f===n?s?x=a([]):x=a([[m,"on"]]):w==="on"?x=a([[m,"on"]]):x=a([]),Oe(j,x)}),c=Oe(l,u);return[new K(e.materials,e.entities,e.flows,De(o,c),e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,e.value_activities),E()]}else if(t instanceof Is){let n=t.flow_id,r=sa(e,n);if(r instanceof $){let i=r[0],s=we(e.flows,c=>i.flow_id!==c.flow_id),o,l=new K(e.materials,e.entities,s,e.form,e.current_form,e.next_material_id,e.next_entity_id,e.next_flow_id,e.selected_material_ids,e.value_activities);o=vs(l);let u=o;return bs(i.flow_id),[u,E()]}else return[e,E()]}else if(t instanceof Ns){let n=Qh(e);return Uc(n),[e,E()]}else{let n=t.json_data,r=Zh(n);if(r instanceof $){let i=r[0],s=mn(o=>Hc(i.entities,i.materials,i.flows));return[i,s]}else return[e,E()]}}}function rf(){let e=Dr(em,tm,Gh);return qr(e,"resource-pooling")}var oa="src/viz.gleam",_r=class extends p{constructor(t,n){super(),this.page=t,this.show_menu=n}},Us=class extends p{},Hs=class extends p{},la=class extends p{};function rm(e){return new _r("Resource Pooling",!0)}function im(e,t){return t instanceof Us?new _r("Flow Map",e.show_menu):t instanceof Hs?new _r("Resource Pooling",e.show_menu):new _r(e.page,!e.show_menu)}function sm(e){let t="bg-gray-900 text-gray-200 flex flex-col py-12 transition-all duration-300 ease-in-out flex-shrink-0";return k(e.show_menu?t+" w-64 px-4":t+" w-16 px-2")}function om(e){return k(e.show_menu?"flex flex-col":"hidden")}function sf(e,t){let n="rounded-md px-3 py-2 text-sm font-medium text-gray-200 hover:bg-white/5 hover:text-white cursor-pointer";return k(e===t.page?n+" bg-gray-950":n)}function of(e,t){return k(e.page===t?"w-full h-full":"hidden")}function lm(e){return O(a([k("min-h-screen flex bg-gray-200 overflow-auto")]),a([Su(a([sm(e)]),a([Di(a([k("rounded-md px-3 py-2 text-sm font-medium text-gray-200 hover:bg-white/5 hover:text-white cursor-pointer mb-4"),he(new la)]),a([jn(a([W("stroke-width","1.5"),W("stroke","currentColor"),k("size-6")]),a([En(a([W("stroke-linecap","round"),W("stroke-linejoin","round"),W("d","M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5")]))]))])),O(a([om(e)]),a([Di(a([sf("Flow Map",e),he(new Us)]),a([F("Flow Map")])),Di(a([sf("Resource Pooling",e),he(new Hs)]),a([F("Resource Pooling")]))]))])),O(a([k("flex flex-col p-12 flex-1 min-w-0")]),a([Eu(a([k("text-4xl font-extrabold")]),a([F(e.page)])),O(a([k("flex-1 w-full py-4")]),a([O(a([of(e,"Flow Map")]),a([Bc()])),O(a([of(e,"Resource Pooling")]),a([Kc()]))]))]))]))}function lf(){let e=ec(rm,im,lm),t=qc();if(!(t instanceof $))throw mr("let_assert",oa,"viz",14,"main","Pattern match failed, no pattern matched the value.",{value:t,start:295,end:333,pattern_start:306,pattern_end:311});let n=rf();if(!(n instanceof $))throw mr("let_assert",oa,"viz",15,"main","Pattern match failed, no pattern matched the value.",{value:n,start:336,end:382,pattern_start:347,pattern_end:352});let r=tc(e,"body",void 0);if(!(r instanceof $))throw mr("let_assert",oa,"viz",16,"main","Pattern match failed, no pattern matched the value.",{value:r,start:385,end:434,pattern_start:396,pattern_end:401})}lf();
